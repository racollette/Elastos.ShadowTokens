{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Insight = exports.broadcastTransaction = void 0;\n\nconst axios_1 = __importDefault(require(\"axios\"));\n\nconst https_1 = __importDefault(require(\"https\"));\n\nconst utxo_1 = require(\"../../lib/utxo\");\n\nconst timeout_1 = require(\"./timeout\");\n\nconst fetchUTXOs = insightURL => async (address, confirmations) => {\n  const url = `${insightURL.replace(/\\/$/, \"\")}/addr/${address}/utxo`;\n  const response = await axios_1.default.get(url, {\n    // TODO: Remove when certificate is fixed.\n    httpsAgent: new https_1.default.Agent({\n      rejectUnauthorized: false\n    }),\n    timeout: timeout_1.DEFAULT_TIMEOUT\n  });\n  const data = typeof response.data === \"string\" ? JSON.parse(response.data) : response.data;\n  return data.map(utxo => ({\n    txHash: utxo.txid,\n    amount: utxo.satoshis || utxo_1.fixValue(utxo.amount, 8),\n    // script_hex: utxo.scriptPubKey,\n    vOut: utxo.vout,\n    confirmations: utxo.confirmations\n  })).filter(utxo => confirmations === 0 || utxo.confirmations >= confirmations).sort(utxo_1.sortUTXOs);\n};\n\nconst fetchConfirmations = insightURL => async txHash => {\n  const url = `${insightURL.replace(/\\/$/, \"\")}/tx/${txHash}`;\n  const response = await axios_1.default.get(url, {\n    timeout: timeout_1.DEFAULT_TIMEOUT\n  });\n  return response.data.confirmations;\n};\n\nconst fetchUTXO = insightURL => async (txHash, vOut) => {\n  const url = `${insightURL.replace(/\\/$/, \"\")}/tx/${txHash}`;\n  const tx = (await axios_1.default.get(url, {\n    timeout: timeout_1.DEFAULT_TIMEOUT\n  })).data;\n  return utxo_1.fixUTXO({\n    txHash,\n    amount: parseFloat(tx.vout[vOut].value),\n    vOut,\n    confirmations: tx.confirmations\n  }, 8);\n};\n\nexports.broadcastTransaction = insightURL => async txHex => {\n  const url = `${insightURL.replace(/\\/$/, \"\")}/tx/send`;\n  const response = await axios_1.default.post(url, {\n    rawtx: txHex\n  }, {\n    timeout: timeout_1.DEFAULT_TIMEOUT\n  });\n\n  if (response.data.error) {\n    throw new Error(response.data.error);\n  }\n\n  return response.data.txid;\n};\n\nexports.Insight = {\n  fetchUTXO,\n  fetchUTXOs,\n  fetchConfirmations,\n  broadcastTransaction: exports.broadcastTransaction\n};","map":{"version":3,"sources":["../../../../src/common/apis/insight.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Insight = exports.broadcastTransaction = void 0;\nconst axios_1 = __importDefault(require(\"axios\"));\nconst https_1 = __importDefault(require(\"https\"));\nconst utxo_1 = require(\"../../lib/utxo\");\nconst timeout_1 = require(\"./timeout\");\nconst fetchUTXOs = (insightURL) => async (address, confirmations) => {\n    const url = `${insightURL.replace(/\\/$/, \"\")}/addr/${address}/utxo`;\n    const response = await axios_1.default.get(url, {\n        // TODO: Remove when certificate is fixed.\n        httpsAgent: new https_1.default.Agent({\n            rejectUnauthorized: false\n        }),\n        timeout: timeout_1.DEFAULT_TIMEOUT,\n    });\n    const data = typeof response.data === \"string\" ? JSON.parse(response.data) : response.data;\n    return data.map(utxo => ({\n        txHash: utxo.txid,\n        amount: utxo.satoshis || utxo_1.fixValue(utxo.amount, 8),\n        // script_hex: utxo.scriptPubKey,\n        vOut: utxo.vout,\n        confirmations: utxo.confirmations,\n    }))\n        .filter(utxo => confirmations === 0 || utxo.confirmations >= confirmations)\n        .sort(utxo_1.sortUTXOs);\n};\nconst fetchConfirmations = (insightURL) => async (txHash) => {\n    const url = `${insightURL.replace(/\\/$/, \"\")}/tx/${txHash}`;\n    const response = await axios_1.default.get(url, { timeout: timeout_1.DEFAULT_TIMEOUT });\n    return response.data.confirmations;\n};\nconst fetchUTXO = (insightURL) => async (txHash, vOut) => {\n    const url = `${insightURL.replace(/\\/$/, \"\")}/tx/${txHash}`;\n    const tx = (await axios_1.default.get(url, { timeout: timeout_1.DEFAULT_TIMEOUT })).data;\n    return utxo_1.fixUTXO({\n        txHash,\n        amount: parseFloat(tx.vout[vOut].value),\n        vOut,\n        confirmations: tx.confirmations,\n    }, 8);\n};\nexports.broadcastTransaction = (insightURL) => async (txHex) => {\n    const url = `${insightURL.replace(/\\/$/, \"\")}/tx/send`;\n    const response = await axios_1.default.post(url, { rawtx: txHex }, { timeout: timeout_1.DEFAULT_TIMEOUT });\n    if (response.data.error) {\n        throw new Error(response.data.error);\n    }\n    return response.data.txid;\n};\nexports.Insight = {\n    fetchUTXO,\n    fetchUTXOs,\n    fetchConfirmations,\n    broadcastTransaction: exports.broadcastTransaction,\n};\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5zaWdodC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21tb24vYXBpcy9pbnNpZ2h0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLGtEQUEwQjtBQUMxQixrREFBMEI7QUFFMUIseUNBQW9FO0FBQ3BFLHVDQUE0QztBQWE1QyxNQUFNLFVBQVUsR0FBRyxDQUFDLFVBQWtCLEVBQUUsRUFBRSxDQUFDLEtBQUssRUFBRSxPQUFlLEVBQUUsYUFBcUIsRUFBNEIsRUFBRTtJQUNsSCxNQUFNLEdBQUcsR0FBRyxHQUFHLFVBQVUsQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxTQUFTLE9BQU8sT0FBTyxDQUFDO0lBQ3BFLE1BQU0sUUFBUSxHQUFHLE1BQU0sZUFBSyxDQUFDLEdBQUcsQ0FBa0IsR0FBRyxFQUFFO1FBQ25ELDBDQUEwQztRQUMxQyxVQUFVLEVBQUUsSUFBSSxlQUFLLENBQUMsS0FBSyxDQUFDO1lBQ3hCLGtCQUFrQixFQUFFLEtBQUs7U0FDNUIsQ0FBQztRQUNGLE9BQU8sRUFBRSx5QkFBZTtLQUMzQixDQUFDLENBQUM7SUFFSCxNQUFNLElBQUksR0FBb0IsT0FBTyxRQUFRLENBQUMsSUFBSSxLQUFLLFFBQVEsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUM7SUFFNUcsT0FBTyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUNyQixNQUFNLEVBQUUsSUFBSSxDQUFDLElBQUk7UUFDakIsTUFBTSxFQUFFLElBQUksQ0FBQyxRQUFRLElBQUksZUFBUSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDO1FBQ2pELGlDQUFpQztRQUNqQyxJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUk7UUFDZixhQUFhLEVBQUUsSUFBSSxDQUFDLGFBQWE7S0FDcEMsQ0FBQyxDQUFDO1NBQ0UsTUFBTSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsYUFBYSxLQUFLLENBQUMsSUFBSSxJQUFJLENBQUMsYUFBYSxJQUFJLGFBQWEsQ0FBQztTQUMxRSxJQUFJLENBQUMsZ0JBQVMsQ0FBQyxDQUFDO0FBQ3pCLENBQUMsQ0FBQztBQTJERixNQUFNLGtCQUFrQixHQUFHLENBQUMsVUFBa0IsRUFBRSxFQUFFLENBQUMsS0FBSyxFQUFFLE1BQWMsRUFBbUIsRUFBRTtJQUN6RixNQUFNLEdBQUcsR0FBRyxHQUFHLFVBQVUsQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxPQUFPLE1BQU0sRUFBRSxDQUFDO0lBQzVELE1BQU0sUUFBUSxHQUFHLE1BQU0sZUFBSyxDQUFDLEdBQUcsQ0FBYSxHQUFHLEVBQUUsRUFBRSxPQUFPLEVBQUUseUJBQWUsRUFBRSxDQUFDLENBQUM7SUFDaEYsT0FBTyxRQUFRLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQztBQUN2QyxDQUFDLENBQUM7QUFFRixNQUFNLFNBQVMsR0FBRyxDQUFDLFVBQWtCLEVBQUUsRUFBRSxDQUFDLEtBQUssRUFBRSxNQUFjLEVBQUUsSUFBWSxFQUFpQixFQUFFO0lBQzVGLE1BQU0sR0FBRyxHQUFHLEdBQUcsVUFBVSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLE9BQU8sTUFBTSxFQUFFLENBQUM7SUFDNUQsTUFBTSxFQUFFLEdBQUcsQ0FBQyxNQUFNLGVBQUssQ0FBQyxHQUFHLENBQWEsR0FBRyxFQUFFLEVBQUUsT0FBTyxFQUFFLHlCQUFlLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO0lBQ2pGLE9BQU8sY0FBTyxDQUFDO1FBQ1gsTUFBTTtRQUNOLE1BQU0sRUFBRSxVQUFVLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxLQUFLLENBQUM7UUFDdkMsSUFBSTtRQUNKLGFBQWEsRUFBRSxFQUFFLENBQUMsYUFBYTtLQUNsQyxFQUFFLENBQUMsQ0FBQyxDQUFDO0FBQ1YsQ0FBQyxDQUFDO0FBRVcsUUFBQSxvQkFBb0IsR0FBRyxDQUFDLFVBQWtCLEVBQUUsRUFBRSxDQUFDLEtBQUssRUFBRSxLQUFhLEVBQW1CLEVBQUU7SUFDakcsTUFBTSxHQUFHLEdBQUcsR0FBRyxVQUFVLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsVUFBVSxDQUFDO0lBQ3ZELE1BQU0sUUFBUSxHQUFHLE1BQU0sZUFBSyxDQUFDLElBQUksQ0FDN0IsR0FBRyxFQUNILEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxFQUNoQixFQUFFLE9BQU8sRUFBRSx5QkFBZSxFQUFFLENBQy9CLENBQUM7SUFDRixJQUFJLFFBQVEsQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFO1FBQ3JCLE1BQU0sSUFBSSxLQUFLLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztLQUN4QztJQUNELE9BQU8sUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUM7QUFDOUIsQ0FBQyxDQUFDO0FBRVcsUUFBQSxPQUFPLEdBQUc7SUFDbkIsU0FBUztJQUNULFVBQVU7SUFDVixrQkFBa0I7SUFDbEIsb0JBQW9CLEVBQXBCLDRCQUFvQjtDQUN2QixDQUFBIn0="]},"metadata":{},"sourceType":"script"}