{"ast":null,"code":"'use strict';\n\nvar _ = require('lodash');\n\nvar $ = require('../util/preconditions');\n\nvar BN = require('../crypto/bn');\n\nvar buffer = require('buffer');\n\nvar BufferWriter = require('../encoding/bufferwriter');\n\nvar BufferUtil = require('../util/buffer');\n\nvar JSUtil = require('../util/js'); // TODO: Update ZCProof for Groth\n//var ZCProof = require('../zcash/proof');\n\n\nvar ZC_NUM_JS_INPUTS = 2;\nvar ZC_NUM_JS_OUTPUTS = 2; // leading + v + rho + r + memo + auth\n\nvar ZC_NOTECIPHERTEXT_SIZE = 1 + 8 + 32 + 32 + 512 + 16;\n\nfunction JSDescription(params) {\n  if (!(this instanceof JSDescription)) {\n    return new JSDescription(params);\n  }\n\n  this.nullifiers = [];\n  this.commitments = [];\n  this.ciphertexts = [];\n  this.macs = [];\n\n  if (params) {\n    return this._fromObject(params);\n  }\n}\n\nObject.defineProperty(JSDescription.prototype, 'vpub_old', {\n  configurable: false,\n  enumerable: true,\n  get: function () {\n    return this._vpub_old;\n  },\n  set: function (num) {\n    if (num instanceof BN) {\n      this._vpub_oldBN = num;\n      this._vpub_old = num.toNumber();\n    } else if (_.isString(num)) {\n      this._vpub_old = parseInt(num);\n      this._vpub_oldBN = BN.fromNumber(this._vpub_old);\n    } else {\n      $.checkArgument(JSUtil.isNaturalNumber(num), 'vpub_old is not a natural number');\n      this._vpub_oldBN = BN.fromNumber(num);\n      this._vpub_old = num;\n    }\n\n    $.checkState(JSUtil.isNaturalNumber(this._vpub_old), 'vpub_old is not a natural number');\n  }\n});\nObject.defineProperty(JSDescription.prototype, 'vpub_new', {\n  configurable: false,\n  enumerable: true,\n  get: function () {\n    return this._vpub_new;\n  },\n  set: function (num) {\n    if (num instanceof BN) {\n      this._vpub_newBN = num;\n      this._vpub_new = num.toNumber();\n    } else if (_.isString(num)) {\n      this._vpub_new = parseInt(num);\n      this._vpub_newBN = BN.fromNumber(this._vpub_new);\n    } else {\n      $.checkArgument(JSUtil.isNaturalNumber(num), 'vpub_new is not a natural number');\n      this._vpub_newBN = BN.fromNumber(num);\n      this._vpub_new = num;\n    }\n\n    $.checkState(JSUtil.isNaturalNumber(this._vpub_new), 'vpub_new is not a natural number');\n  }\n});\n\nJSDescription.fromObject = function (obj) {\n  $.checkArgument(_.isObject(obj));\n  var jsdesc = new JSDescription();\n  return jsdesc._fromObject(obj);\n};\n\nJSDescription.prototype._fromObject = function (params) {\n  var nullifiers = [];\n\n  _.each(params.nullifiers, function (nullifier) {\n    nullifiers.push(BufferUtil.reverse(new buffer.Buffer(nullifier, 'hex')));\n  });\n\n  var commitments = [];\n\n  _.each(params.commitments, function (commitment) {\n    commitments.push(BufferUtil.reverse(new buffer.Buffer(commitment, 'hex')));\n  });\n\n  var ciphertexts = [];\n\n  _.each(params.ciphertexts, function (ciphertext) {\n    ciphertexts.push(new buffer.Buffer(ciphertext, 'hex'));\n  });\n\n  var macs = [];\n\n  _.each(params.macs, function (mac) {\n    macs.push(BufferUtil.reverse(new buffer.Buffer(mac, 'hex')));\n  });\n\n  this.vpub_old = params.vpub_old;\n  this.vpub_new = params.vpub_new;\n  this.anchor = BufferUtil.reverse(new buffer.Buffer(params.anchor, 'hex'));\n  this.nullifiers = nullifiers;\n  this.commitments = commitments;\n  this.ephemeralKey = BufferUtil.reverse(new buffer.Buffer(params.ephemeralKey, 'hex'));\n  this.ciphertexts = ciphertexts;\n  this.randomSeed = BufferUtil.reverse(new buffer.Buffer(params.randomSeed, 'hex'));\n  this.macs = macs;\n  this.proof = params.proof; // TODO: Update ZCProof for Groth: ZCProof.fromObject(params.proof);\n\n  return this;\n};\n\nJSDescription.prototype.toObject = JSDescription.prototype.toJSON = function toObject() {\n  var nullifiers = [];\n\n  _.each(this.nullifiers, function (nullifier) {\n    nullifiers.push(BufferUtil.reverse(nullifier).toString('hex'));\n  });\n\n  var commitments = [];\n\n  _.each(this.commitments, function (commitment) {\n    commitments.push(BufferUtil.reverse(commitment).toString('hex'));\n  });\n\n  var ciphertexts = [];\n\n  _.each(this.ciphertexts, function (ciphertext) {\n    ciphertexts.push(ciphertext.toString('hex'));\n  });\n\n  var macs = [];\n\n  _.each(this.macs, function (mac) {\n    macs.push(BufferUtil.reverse(mac).toString('hex'));\n  });\n\n  var obj = {\n    vpub_old: this.vpub_old,\n    vpub_new: this.vpub_new,\n    anchor: BufferUtil.reverse(this.anchor).toString('hex'),\n    nullifiers: nullifiers,\n    commitments: commitments,\n    ephemeralKey: BufferUtil.reverse(this.ephemeralKey).toString('hex'),\n    ciphertexts: ciphertexts,\n    randomSeed: BufferUtil.reverse(this.randomSeed).toString('hex'),\n    macs: macs,\n    proof: this.proof // TODO: Update ZCProof for Groth: this.proof.toObject(),\n\n  };\n  return obj;\n};\n\nJSDescription.fromBufferReader = function (br, useGrothFlagParam) {\n  var i;\n  var jsdesc = new JSDescription();\n  jsdesc.vpub_old = br.readUInt64LEBN();\n  jsdesc.vpub_new = br.readUInt64LEBN();\n  jsdesc.anchor = br.read(32);\n\n  for (i = 0; i < ZC_NUM_JS_INPUTS; i++) {\n    jsdesc.nullifiers.push(br.read(32));\n  }\n\n  for (i = 0; i < ZC_NUM_JS_OUTPUTS; i++) {\n    jsdesc.commitments.push(br.read(32));\n  }\n\n  jsdesc.ephemeralKey = br.read(32);\n  jsdesc.randomSeed = br.read(32);\n\n  for (i = 0; i < ZC_NUM_JS_INPUTS; i++) {\n    jsdesc.macs.push(br.read(32));\n  } // Default parameter requires ECMASCript 6 which might not be available, so use workaround.\n\n\n  var useGrothFlag = useGrothFlagParam || false;\n\n  if (!useGrothFlag) {\n    jsdesc.proof = br.read(296); // TODO: Update ZCProof for Groth: ZCProof.fromBufferReader(br);\n  } else {\n    jsdesc.proof = br.read(48 + 96 + 48);\n  }\n\n  for (i = 0; i < ZC_NUM_JS_OUTPUTS; i++) {\n    jsdesc.ciphertexts.push(br.read(ZC_NOTECIPHERTEXT_SIZE));\n  }\n\n  return jsdesc;\n};\n\nJSDescription.prototype.toBufferWriter = function (writer) {\n  var i;\n\n  if (!writer) {\n    writer = new BufferWriter();\n  }\n\n  writer.writeUInt64LEBN(this._vpub_oldBN);\n  writer.writeUInt64LEBN(this._vpub_newBN);\n  writer.write(this.anchor);\n\n  for (i = 0; i < ZC_NUM_JS_INPUTS; i++) {\n    writer.write(this.nullifiers[i]);\n  }\n\n  for (i = 0; i < ZC_NUM_JS_OUTPUTS; i++) {\n    writer.write(this.commitments[i]);\n  }\n\n  writer.write(this.ephemeralKey);\n  writer.write(this.randomSeed);\n\n  for (i = 0; i < ZC_NUM_JS_INPUTS; i++) {\n    writer.write(this.macs[i]);\n  } // TODO: Update ZCProof for Groth: this.proof.toBufferWriter(writer);\n\n\n  writer.write(this.proof);\n\n  for (i = 0; i < ZC_NUM_JS_OUTPUTS; i++) {\n    writer.write(this.ciphertexts[i]);\n  }\n\n  return writer;\n};\n\nmodule.exports = JSDescription;","map":{"version":3,"sources":["/home/ryan/dev/defi/bridge/node_modules/bitcore-lib-zcash/lib/transaction/jsdescription.js"],"names":["_","require","$","BN","buffer","BufferWriter","BufferUtil","JSUtil","ZC_NUM_JS_INPUTS","ZC_NUM_JS_OUTPUTS","ZC_NOTECIPHERTEXT_SIZE","JSDescription","params","nullifiers","commitments","ciphertexts","macs","_fromObject","Object","defineProperty","prototype","configurable","enumerable","get","_vpub_old","set","num","_vpub_oldBN","toNumber","isString","parseInt","fromNumber","checkArgument","isNaturalNumber","checkState","_vpub_new","_vpub_newBN","fromObject","obj","isObject","jsdesc","each","nullifier","push","reverse","Buffer","commitment","ciphertext","mac","vpub_old","vpub_new","anchor","ephemeralKey","randomSeed","proof","toObject","toJSON","toString","fromBufferReader","br","useGrothFlagParam","i","readUInt64LEBN","read","useGrothFlag","toBufferWriter","writer","writeUInt64LEBN","write","module","exports"],"mappings":"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","sourcesContent":["'use strict';\n\nvar _ = require('lodash');\nvar $ = require('../util/preconditions');\nvar BN = require('../crypto/bn');\nvar buffer = require('buffer');\nvar BufferWriter = require('../encoding/bufferwriter');\nvar BufferUtil = require('../util/buffer');\nvar JSUtil = require('../util/js');\n\n// TODO: Update ZCProof for Groth\n//var ZCProof = require('../zcash/proof');\n\nvar ZC_NUM_JS_INPUTS = 2;\nvar ZC_NUM_JS_OUTPUTS = 2;\n\n// leading + v + rho + r + memo + auth\nvar ZC_NOTECIPHERTEXT_SIZE = 1 + 8 + 32 + 32 + 512 + 16;\n\nfunction JSDescription(params) {\n  if (!(this instanceof JSDescription)) {\n    return new JSDescription(params);\n  }\n  this.nullifiers = [];\n  this.commitments = [];\n  this.ciphertexts = [];\n  this.macs = [];\n  if (params) {\n    return this._fromObject(params);\n  }\n}\n\nObject.defineProperty(JSDescription.prototype, 'vpub_old', {\n  configurable: false,\n  enumerable: true,\n  get: function() {\n    return this._vpub_old;\n  },\n  set: function(num) {\n    if (num instanceof BN) {\n      this._vpub_oldBN = num;\n      this._vpub_old = num.toNumber();\n    } else if (_.isString(num)) {\n      this._vpub_old = parseInt(num);\n      this._vpub_oldBN = BN.fromNumber(this._vpub_old);\n    } else {\n      $.checkArgument(\n        JSUtil.isNaturalNumber(num),\n        'vpub_old is not a natural number'\n      );\n      this._vpub_oldBN = BN.fromNumber(num);\n      this._vpub_old = num;\n    }\n    $.checkState(\n      JSUtil.isNaturalNumber(this._vpub_old),\n      'vpub_old is not a natural number'\n    );\n  }\n});\n\nObject.defineProperty(JSDescription.prototype, 'vpub_new', {\n  configurable: false,\n  enumerable: true,\n  get: function() {\n    return this._vpub_new;\n  },\n  set: function(num) {\n    if (num instanceof BN) {\n      this._vpub_newBN = num;\n      this._vpub_new = num.toNumber();\n    } else if (_.isString(num)) {\n      this._vpub_new = parseInt(num);\n      this._vpub_newBN = BN.fromNumber(this._vpub_new);\n    } else {\n      $.checkArgument(\n        JSUtil.isNaturalNumber(num),\n        'vpub_new is not a natural number'\n      );\n      this._vpub_newBN = BN.fromNumber(num);\n      this._vpub_new = num;\n    }\n    $.checkState(\n      JSUtil.isNaturalNumber(this._vpub_new),\n      'vpub_new is not a natural number'\n    );\n  }\n});\n\nJSDescription.fromObject = function(obj) {\n  $.checkArgument(_.isObject(obj));\n  var jsdesc = new JSDescription();\n  return jsdesc._fromObject(obj);\n};\n\nJSDescription.prototype._fromObject = function(params) {\n  var nullifiers = [];\n  _.each(params.nullifiers, function(nullifier) {\n    nullifiers.push(BufferUtil.reverse(new buffer.Buffer(nullifier, 'hex')));\n  });\n  var commitments = [];\n  _.each(params.commitments, function(commitment) {\n    commitments.push(BufferUtil.reverse(new buffer.Buffer(commitment, 'hex')));\n  });\n  var ciphertexts = [];\n  _.each(params.ciphertexts, function(ciphertext) {\n    ciphertexts.push(new buffer.Buffer(ciphertext, 'hex'));\n  });\n  var macs = [];\n  _.each(params.macs, function(mac) {\n    macs.push(BufferUtil.reverse(new buffer.Buffer(mac, 'hex')));\n  });\n  this.vpub_old = params.vpub_old;\n  this.vpub_new = params.vpub_new;\n  this.anchor = BufferUtil.reverse(new buffer.Buffer(params.anchor, 'hex'));\n  this.nullifiers = nullifiers;\n  this.commitments = commitments;\n  this.ephemeralKey = BufferUtil.reverse(new buffer.Buffer(params.ephemeralKey, 'hex'));\n  this.ciphertexts = ciphertexts;\n  this.randomSeed = BufferUtil.reverse(new buffer.Buffer(params.randomSeed, 'hex'));\n  this.macs = macs;\n  this.proof = params.proof; // TODO: Update ZCProof for Groth: ZCProof.fromObject(params.proof);\n  return this;\n};\n\nJSDescription.prototype.toObject = JSDescription.prototype.toJSON = function toObject() {\n  var nullifiers = [];\n  _.each(this.nullifiers, function(nullifier) {\n    nullifiers.push(BufferUtil.reverse(nullifier).toString('hex'));\n  });\n  var commitments = [];\n  _.each(this.commitments, function(commitment) {\n    commitments.push(BufferUtil.reverse(commitment).toString('hex'));\n  });\n  var ciphertexts = [];\n  _.each(this.ciphertexts, function(ciphertext) {\n    ciphertexts.push(ciphertext.toString('hex'));\n  });\n  var macs = [];\n  _.each(this.macs, function(mac) {\n    macs.push(BufferUtil.reverse(mac).toString('hex'));\n  });\n  var obj = {\n    vpub_old: this.vpub_old,\n    vpub_new: this.vpub_new,\n    anchor: BufferUtil.reverse(this.anchor).toString('hex'),\n    nullifiers: nullifiers,\n    commitments: commitments,\n    ephemeralKey: BufferUtil.reverse(this.ephemeralKey).toString('hex'),\n    ciphertexts: ciphertexts,\n    randomSeed: BufferUtil.reverse(this.randomSeed).toString('hex'),\n    macs: macs,\n    proof: this.proof, // TODO: Update ZCProof for Groth: this.proof.toObject(),\n  };\n  return obj;\n};\n\nJSDescription.fromBufferReader = function(br, useGrothFlagParam) {\n  var i;\n  var jsdesc = new JSDescription();\n  jsdesc.vpub_old = br.readUInt64LEBN();\n  jsdesc.vpub_new = br.readUInt64LEBN();\n  jsdesc.anchor = br.read(32);\n  for (i = 0; i < ZC_NUM_JS_INPUTS; i++) {\n    jsdesc.nullifiers.push(br.read(32));\n  }\n  for (i = 0; i < ZC_NUM_JS_OUTPUTS; i++) {\n    jsdesc.commitments.push(br.read(32));\n  }\n  jsdesc.ephemeralKey = br.read(32);\n  jsdesc.randomSeed = br.read(32);\n  for (i = 0; i < ZC_NUM_JS_INPUTS; i++) {\n    jsdesc.macs.push(br.read(32));\n  }\n\n  // Default parameter requires ECMASCript 6 which might not be available, so use workaround.\n  var useGrothFlag = useGrothFlagParam || false;\n  if (!useGrothFlag) {\n    jsdesc.proof = br.read(296); // TODO: Update ZCProof for Groth: ZCProof.fromBufferReader(br);\n  } else {\n    jsdesc.proof = br.read(48 + 96 + 48);\n  }\n\n  for (i = 0; i < ZC_NUM_JS_OUTPUTS; i++) {\n    jsdesc.ciphertexts.push(br.read(ZC_NOTECIPHERTEXT_SIZE));\n  }\n  return jsdesc;\n};\n\nJSDescription.prototype.toBufferWriter = function(writer) {\n  var i;\n  if (!writer) {\n    writer = new BufferWriter();\n  }\n  writer.writeUInt64LEBN(this._vpub_oldBN);\n  writer.writeUInt64LEBN(this._vpub_newBN);\n  writer.write(this.anchor);\n  for (i = 0; i < ZC_NUM_JS_INPUTS; i++) {\n    writer.write(this.nullifiers[i]);\n  }\n  for (i = 0; i < ZC_NUM_JS_OUTPUTS; i++) {\n    writer.write(this.commitments[i]);\n  }\n  writer.write(this.ephemeralKey);\n  writer.write(this.randomSeed);\n  for (i = 0; i < ZC_NUM_JS_INPUTS; i++) {\n    writer.write(this.macs[i]);\n  }\n\n  // TODO: Update ZCProof for Groth: this.proof.toBufferWriter(writer);\n  writer.write(this.proof);\n\n  for (i = 0; i < ZC_NUM_JS_OUTPUTS; i++) {\n    writer.write(this.ciphertexts[i]);\n  }\n  return writer;\n};\n\nmodule.exports = JSDescription;\n"]},"metadata":{},"sourceType":"script"}