{"ast":null,"code":"\"use strict\"; // Modified from web3-core-method\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.forwardEvents = exports.newPromiEvent = void 0;\n/*\n    This file is part of web3.js.\n\n    web3.js is free software: you can redistribute it and/or modify\n    it under the terms of the GNU Lesser General Public License as published by\n    the Free Software Foundation, either version 3 of the License, or\n    (at your option) any later version.\n\n    web3.js is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU Lesser General Public License for more details.\n\n    You should have received a copy of the GNU Lesser General Public License\n    along with web3.js.  If not, see <http://www.gnu.org/licenses/>.\n*/\n\n/**\n * @file PromiEvent.js\n * @author Fabian Vogelsteller <fabian@ethereum.org>, Samuel Furter <samuel@ethereum.org>\n * @date 2018\n */\n// tslint:disable: no-any\n\nconst events_1 = require(\"events\");\n\nclass InternalPromiEvent {\n  /**\n   * @constructor\n   */\n  constructor() {\n    // tslint:disable-next-line: promise-must-complete\n    this.promise = new Promise((resolve, reject) => {\n      this.resolve = resolve;\n      this.reject = reject;\n    });\n    this.eventEmitter = new events_1.EventEmitter();\n    return new Proxy(this, {\n      get: this.proxyHandler\n    });\n  }\n  /**\n   * Proxy handler to call the promise or eventEmitter methods\n   */\n\n\n  proxyHandler(target, name) {\n    if (name === 'resolve' || name === 'reject') {\n      return target[name];\n    }\n\n    if (name === 'then') {\n      return target.promise.then.bind(target.promise);\n    }\n\n    if (name === 'catch') {\n      return target.promise.catch.bind(target.promise);\n    }\n\n    if (target.eventEmitter[name]) {\n      return target.eventEmitter[name];\n    }\n  }\n\n}\n\nexports.newPromiEvent = () => new InternalPromiEvent();\n\nexports.forwardEvents = (src, dest, filterFn = _name => true) => {\n  // const forwardEmitterNewListener = (eventName: string, listener: (...args: any[]) => void) => {\n  //     if (filterFn(eventName) && listener.name.indexOf(\"__forward_emitter_\") !== 0) {\n  //         console.log(`Forwarding ${eventName} Listener:`);\n  //         console.log(listener);\n  //         src.on(eventName, listener);\n  //         src.on(\"transactionHash\", (txHash) => { console.log(`Got transaction hash on src`); });\n  //     } else {\n  //         console.log(\"Can't forward PromiEvent event!\");\n  //     }\n  // };\n  // const forwardEmitterRemoveListener = (eventName: string, listener: (...args: any[]) => void) => {\n  //     src.removeListener(eventName, listener);\n  // };\n  // // Listeners bound to the destination emitter should be bound to the source emitter.\n  // dest.on(\"newListener\", forwardEmitterNewListener);\n  // // When a listener is removed from the destination emitter, remove it from the source emitter\n  // // (otherwise it will continue to be called).\n  // dest.on(\"removeListener\", forwardEmitterRemoveListener);\n  // Until the above is fixed, we manually forward each event name:\n  src.on('transactionHash', eventReceipt => {\n    dest.emit('transactionHash', eventReceipt);\n  });\n  src.on('receipt', eventReceipt => {\n    dest.emit('receipt', eventReceipt);\n  });\n  src.on('confirmation', (confNumber, eventReceipt) => {\n    dest.emit('confirmation', confNumber, eventReceipt);\n  });\n  src.on('error', error => {\n    dest.emit('error', error);\n  });\n};","map":{"version":3,"sources":["../../../src/lib/promiEvent.ts"],"names":[],"mappings":"cAAA;;;;;;AAEA;;;;;;;;;;;;;;;;;AAgBA;;;;;AAMA;;AAEA,MAAA,QAAA,GAAA,OAAA,CAAA,QAAA,CAAA;;AAGA,MAAM,kBAAN,CAAwB;AAkCpB;;;AAGA,EAAA,WAAA,GAAA;AACI;AACA,SAAK,OAAL,GAAe,IAAI,OAAJ,CAAe,CAAC,OAAD,EAAU,MAAV,KAAoB;AAC9C,WAAK,OAAL,GAAe,OAAf;AACA,WAAK,MAAL,GAAc,MAAd;AACH,KAHc,CAAf;AAKA,SAAK,YAAL,GAAoB,IAAI,QAAA,CAAA,YAAJ,EAApB;AAEA,WAAO,IAAI,KAAJ,CAAU,IAAV,EAAgB;AACnB,MAAA,GAAG,EAAE,KAAK;AADS,KAAhB,CAAP;AAGH;AAED;;;;;AAGO,EAAA,YAAY,CAAC,MAAD,EAAwB,IAAxB,EAAoC;AACnD,QAAI,IAAI,KAAK,SAAT,IAAsB,IAAI,KAAK,QAAnC,EAA6C;AACzC,aAAO,MAAM,CAAC,IAAD,CAAb;AACH;;AAED,QAAI,IAAI,KAAK,MAAb,EAAqB;AACjB,aAAO,MAAM,CAAC,OAAP,CAAe,IAAf,CAAoB,IAApB,CAAyB,MAAM,CAAC,OAAhC,CAAP;AACH;;AAED,QAAI,IAAI,KAAK,OAAb,EAAsB;AAClB,aAAO,MAAM,CAAC,OAAP,CAAe,KAAf,CAAqB,IAArB,CAA0B,MAAM,CAAC,OAAjC,CAAP;AACH;;AAED,QAAK,MAAc,CAAC,YAAf,CAA4B,IAA5B,CAAL,EAAwC;AACpC,aAAQ,MAAc,CAAC,YAAf,CAA4B,IAA5B,CAAR;AACH;AACJ;;AAtEmB;;AA2EX,OAAA,CAAA,aAAA,GAAgB,MACzB,IAAI,kBAAJ,EADS;;AAGA,OAAA,CAAA,aAAA,GAAgB,CACzB,GADyB,EAEzB,IAFyB,EAGzB,QAAA,GAAY,KAAD,IAAmB,IAHL,KAIzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA,EAAA,GAAG,CAAC,EAAJ,CAAO,iBAAP,EAA2B,YAAD,IAAyB;AAC/C,IAAA,IAAI,CAAC,IAAL,CAAU,iBAAV,EAA6B,YAA7B;AACH,GAFD;AAGA,EAAA,GAAG,CAAC,EAAJ,CAAO,SAAP,EAAmB,YAAD,IAAqC;AACnD,IAAA,IAAI,CAAC,IAAL,CAAU,SAAV,EAAqB,YAArB;AACH,GAFD;AAGA,EAAA,GAAG,CAAC,EAAJ,CACI,cADJ,EAEI,CAAC,UAAD,EAAqB,YAArB,KAAyD;AACrD,IAAA,IAAI,CAAC,IAAL,CAAU,cAAV,EAA0B,UAA1B,EAAsC,YAAtC;AACH,GAJL;AAMA,EAAA,GAAG,CAAC,EAAJ,CAAO,OAAP,EAAiB,KAAD,IAAiB;AAC7B,IAAA,IAAI,CAAC,IAAL,CAAU,OAAV,EAAmB,KAAnB;AACH,GAFD;AAGH,CA3CY","sourceRoot":"","sourcesContent":["\"use strict\";\n// Modified from web3-core-method\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.forwardEvents = exports.newPromiEvent = void 0;\n/*\n    This file is part of web3.js.\n\n    web3.js is free software: you can redistribute it and/or modify\n    it under the terms of the GNU Lesser General Public License as published by\n    the Free Software Foundation, either version 3 of the License, or\n    (at your option) any later version.\n\n    web3.js is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU Lesser General Public License for more details.\n\n    You should have received a copy of the GNU Lesser General Public License\n    along with web3.js.  If not, see <http://www.gnu.org/licenses/>.\n*/\n/**\n * @file PromiEvent.js\n * @author Fabian Vogelsteller <fabian@ethereum.org>, Samuel Furter <samuel@ethereum.org>\n * @date 2018\n */\n// tslint:disable: no-any\nconst events_1 = require(\"events\");\nclass InternalPromiEvent {\n    /**\n     * @constructor\n     */\n    constructor() {\n        // tslint:disable-next-line: promise-must-complete\n        this.promise = new Promise((resolve, reject) => {\n            this.resolve = resolve;\n            this.reject = reject;\n        });\n        this.eventEmitter = new events_1.EventEmitter();\n        return new Proxy(this, {\n            get: this.proxyHandler\n        });\n    }\n    /**\n     * Proxy handler to call the promise or eventEmitter methods\n     */\n    proxyHandler(target, name) {\n        if (name === 'resolve' || name === 'reject') {\n            return target[name];\n        }\n        if (name === 'then') {\n            return target.promise.then.bind(target.promise);\n        }\n        if (name === 'catch') {\n            return target.promise.catch.bind(target.promise);\n        }\n        if (target.eventEmitter[name]) {\n            return target.eventEmitter[name];\n        }\n    }\n}\nexports.newPromiEvent = () => new InternalPromiEvent();\nexports.forwardEvents = (src, dest, filterFn = (_name) => true) => {\n    // const forwardEmitterNewListener = (eventName: string, listener: (...args: any[]) => void) => {\n    //     if (filterFn(eventName) && listener.name.indexOf(\"__forward_emitter_\") !== 0) {\n    //         console.log(`Forwarding ${eventName} Listener:`);\n    //         console.log(listener);\n    //         src.on(eventName, listener);\n    //         src.on(\"transactionHash\", (txHash) => { console.log(`Got transaction hash on src`); });\n    //     } else {\n    //         console.log(\"Can't forward PromiEvent event!\");\n    //     }\n    // };\n    // const forwardEmitterRemoveListener = (eventName: string, listener: (...args: any[]) => void) => {\n    //     src.removeListener(eventName, listener);\n    // };\n    // // Listeners bound to the destination emitter should be bound to the source emitter.\n    // dest.on(\"newListener\", forwardEmitterNewListener);\n    // // When a listener is removed from the destination emitter, remove it from the source emitter\n    // // (otherwise it will continue to be called).\n    // dest.on(\"removeListener\", forwardEmitterRemoveListener);\n    // Until the above is fixed, we manually forward each event name:\n    src.on('transactionHash', (eventReceipt) => {\n        dest.emit('transactionHash', eventReceipt);\n    });\n    src.on('receipt', (eventReceipt) => {\n        dest.emit('receipt', eventReceipt);\n    });\n    src.on('confirmation', (confNumber, eventReceipt) => {\n        dest.emit('confirmation', confNumber, eventReceipt);\n    });\n    src.on('error', (error) => {\n        dest.emit('error', error);\n    });\n};\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvbWlFdmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9saWIvcHJvbWlFdmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsaUNBQWlDOzs7QUFFakM7Ozs7Ozs7Ozs7Ozs7OztFQWVFO0FBQ0Y7Ozs7R0FJRztBQUVILHlCQUF5QjtBQUV6QixtQ0FBc0M7QUFHdEMsTUFBTSxrQkFBa0I7SUFrQ3BCOztPQUVHO0lBQ0g7UUFDSSxrREFBa0Q7UUFDbEQsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLE9BQU8sQ0FBSSxDQUFDLE9BQU8sRUFBRSxNQUFNLEVBQUUsRUFBRTtZQUM5QyxJQUFJLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQztZQUN2QixJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztRQUN6QixDQUFDLENBQUMsQ0FBQztRQUVILElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxxQkFBWSxFQUFFLENBQUM7UUFFdkMsT0FBTyxJQUFJLEtBQUssQ0FBQyxJQUFJLEVBQUU7WUFDbkIsR0FBRyxFQUFFLElBQUksQ0FBQyxZQUFZO1NBQ3pCLENBQUMsQ0FBQztJQUNQLENBQUM7SUFFRDs7T0FFRztJQUNJLFlBQVksQ0FBQyxNQUFxQixFQUFFLElBQVk7UUFDbkQsSUFBSSxJQUFJLEtBQUssU0FBUyxJQUFJLElBQUksS0FBSyxRQUFRLEVBQUU7WUFDekMsT0FBTyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7U0FDdkI7UUFFRCxJQUFJLElBQUksS0FBSyxNQUFNLEVBQUU7WUFDakIsT0FBTyxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1NBQ25EO1FBRUQsSUFBSSxJQUFJLEtBQUssT0FBTyxFQUFFO1lBQ2xCLE9BQU8sTUFBTSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQztTQUNwRDtRQUVELElBQUssTUFBYyxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsRUFBRTtZQUNwQyxPQUFRLE1BQWMsQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLENBQUM7U0FDN0M7SUFDTCxDQUFDO0NBQ0o7QUFJWSxRQUFBLGFBQWEsR0FBRyxHQUFNLEVBQUUsQ0FDakMsSUFBSSxrQkFBa0IsRUFBc0IsQ0FBQztBQUVwQyxRQUFBLGFBQWEsR0FBRyxDQUN6QixHQUFrQixFQUNsQixJQUFtQixFQUNuQixXQUFXLENBQUMsS0FBYSxFQUFFLEVBQUUsQ0FBQyxJQUFJLEVBQ3BDLEVBQUU7SUFDQSxpR0FBaUc7SUFDakcsc0ZBQXNGO0lBQ3RGLDREQUE0RDtJQUM1RCxpQ0FBaUM7SUFDakMsdUNBQXVDO0lBQ3ZDLGtHQUFrRztJQUNsRyxlQUFlO0lBQ2YsMERBQTBEO0lBQzFELFFBQVE7SUFDUixLQUFLO0lBRUwsb0dBQW9HO0lBQ3BHLCtDQUErQztJQUMvQyxLQUFLO0lBRUwsdUZBQXVGO0lBQ3ZGLHFEQUFxRDtJQUVyRCxnR0FBZ0c7SUFDaEcsZ0RBQWdEO0lBQ2hELDJEQUEyRDtJQUUzRCxpRUFBaUU7SUFDakUsR0FBRyxDQUFDLEVBQUUsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDLFlBQW9CLEVBQUUsRUFBRTtRQUMvQyxJQUFJLENBQUMsSUFBSSxDQUFDLGlCQUFpQixFQUFFLFlBQVksQ0FBQyxDQUFDO0lBQy9DLENBQUMsQ0FBQyxDQUFDO0lBQ0gsR0FBRyxDQUFDLEVBQUUsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxZQUFnQyxFQUFFLEVBQUU7UUFDbkQsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsWUFBWSxDQUFDLENBQUM7SUFDdkMsQ0FBQyxDQUFDLENBQUM7SUFDSCxHQUFHLENBQUMsRUFBRSxDQUNGLGNBQWMsRUFDZCxDQUFDLFVBQWtCLEVBQUUsWUFBZ0MsRUFBRSxFQUFFO1FBQ3JELElBQUksQ0FBQyxJQUFJLENBQUMsY0FBYyxFQUFFLFVBQVUsRUFBRSxZQUFZLENBQUMsQ0FBQztJQUN4RCxDQUFDLENBQ0osQ0FBQztJQUNGLEdBQUcsQ0FBQyxFQUFFLENBQUMsT0FBTyxFQUFFLENBQUMsS0FBWSxFQUFFLEVBQUU7UUFDN0IsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDOUIsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDLENBQUMifQ=="]},"metadata":{},"sourceType":"script"}