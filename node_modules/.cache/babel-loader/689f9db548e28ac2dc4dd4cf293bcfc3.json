{"ast":null,"code":"/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n\n/* eslint-env node */\n'use strict';\n\nvar utils = require('../utils');\n\nmodule.exports = {\n  shimGetUserMedia: require('./getusermedia'),\n  shimOnTrack: function (window) {\n    if (typeof window === 'object' && window.RTCPeerConnection && !('ontrack' in window.RTCPeerConnection.prototype)) {\n      Object.defineProperty(window.RTCPeerConnection.prototype, 'ontrack', {\n        get: function () {\n          return this._ontrack;\n        },\n        set: function (f) {\n          if (this._ontrack) {\n            this.removeEventListener('track', this._ontrack);\n            this.removeEventListener('addstream', this._ontrackpoly);\n          }\n\n          this.addEventListener('track', this._ontrack = f);\n          this.addEventListener('addstream', this._ontrackpoly = function (e) {\n            e.stream.getTracks().forEach(function (track) {\n              var event = new Event('track');\n              event.track = track;\n              event.receiver = {\n                track: track\n              };\n              event.transceiver = {\n                receiver: event.receiver\n              };\n              event.streams = [e.stream];\n              this.dispatchEvent(event);\n            }.bind(this));\n          }.bind(this));\n        },\n        enumerable: true,\n        configurable: true\n      });\n    }\n\n    if (typeof window === 'object' && window.RTCTrackEvent && 'receiver' in window.RTCTrackEvent.prototype && !('transceiver' in window.RTCTrackEvent.prototype)) {\n      Object.defineProperty(window.RTCTrackEvent.prototype, 'transceiver', {\n        get: function () {\n          return {\n            receiver: this.receiver\n          };\n        }\n      });\n    }\n  },\n  shimSourceObject: function (window) {\n    // Firefox has supported mozSrcObject since FF22, unprefixed in 42.\n    if (typeof window === 'object') {\n      if (window.HTMLMediaElement && !('srcObject' in window.HTMLMediaElement.prototype)) {\n        // Shim the srcObject property, once, when HTMLMediaElement is found.\n        Object.defineProperty(window.HTMLMediaElement.prototype, 'srcObject', {\n          get: function () {\n            return this.mozSrcObject;\n          },\n          set: function (stream) {\n            this.mozSrcObject = stream;\n          }\n        });\n      }\n    }\n  },\n  shimPeerConnection: function (window) {\n    var browserDetails = utils.detectBrowser(window);\n\n    if (typeof window !== 'object' || !(window.RTCPeerConnection || window.mozRTCPeerConnection)) {\n      return; // probably media.peerconnection.enabled=false in about:config\n    } // The RTCPeerConnection object.\n\n\n    if (!window.RTCPeerConnection) {\n      window.RTCPeerConnection = function (pcConfig, pcConstraints) {\n        if (browserDetails.version < 38) {\n          // .urls is not supported in FF < 38.\n          // create RTCIceServers with a single url.\n          if (pcConfig && pcConfig.iceServers) {\n            var newIceServers = [];\n\n            for (var i = 0; i < pcConfig.iceServers.length; i++) {\n              var server = pcConfig.iceServers[i];\n\n              if (server.hasOwnProperty('urls')) {\n                for (var j = 0; j < server.urls.length; j++) {\n                  var newServer = {\n                    url: server.urls[j]\n                  };\n\n                  if (server.urls[j].indexOf('turn') === 0) {\n                    newServer.username = server.username;\n                    newServer.credential = server.credential;\n                  }\n\n                  newIceServers.push(newServer);\n                }\n              } else {\n                newIceServers.push(pcConfig.iceServers[i]);\n              }\n            }\n\n            pcConfig.iceServers = newIceServers;\n          }\n        }\n\n        return new window.mozRTCPeerConnection(pcConfig, pcConstraints);\n      };\n\n      window.RTCPeerConnection.prototype = window.mozRTCPeerConnection.prototype; // wrap static methods. Currently just generateCertificate.\n\n      if (window.mozRTCPeerConnection.generateCertificate) {\n        Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\n          get: function () {\n            return window.mozRTCPeerConnection.generateCertificate;\n          }\n        });\n      }\n\n      window.RTCSessionDescription = window.mozRTCSessionDescription;\n      window.RTCIceCandidate = window.mozRTCIceCandidate;\n    } // shim away need for obsolete RTCIceCandidate/RTCSessionDescription.\n\n\n    ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate'].forEach(function (method) {\n      var nativeMethod = window.RTCPeerConnection.prototype[method];\n\n      window.RTCPeerConnection.prototype[method] = function () {\n        arguments[0] = new (method === 'addIceCandidate' ? window.RTCIceCandidate : window.RTCSessionDescription)(arguments[0]);\n        return nativeMethod.apply(this, arguments);\n      };\n    }); // support for addIceCandidate(null or undefined)\n\n    var nativeAddIceCandidate = window.RTCPeerConnection.prototype.addIceCandidate;\n\n    window.RTCPeerConnection.prototype.addIceCandidate = function () {\n      if (!arguments[0]) {\n        if (arguments[1]) {\n          arguments[1].apply(null);\n        }\n\n        return Promise.resolve();\n      }\n\n      return nativeAddIceCandidate.apply(this, arguments);\n    }; // shim getStats with maplike support\n\n\n    var makeMapStats = function (stats) {\n      var map = new Map();\n      Object.keys(stats).forEach(function (key) {\n        map.set(key, stats[key]);\n        map[key] = stats[key];\n      });\n      return map;\n    };\n\n    var modernStatsTypes = {\n      inboundrtp: 'inbound-rtp',\n      outboundrtp: 'outbound-rtp',\n      candidatepair: 'candidate-pair',\n      localcandidate: 'local-candidate',\n      remotecandidate: 'remote-candidate'\n    };\n    var nativeGetStats = window.RTCPeerConnection.prototype.getStats;\n\n    window.RTCPeerConnection.prototype.getStats = function (selector, onSucc, onErr) {\n      return nativeGetStats.apply(this, [selector || null]).then(function (stats) {\n        if (browserDetails.version < 48) {\n          stats = makeMapStats(stats);\n        }\n\n        if (browserDetails.version < 53 && !onSucc) {\n          // Shim only promise getStats with spec-hyphens in type names\n          // Leave callback version alone; misc old uses of forEach before Map\n          try {\n            stats.forEach(function (stat) {\n              stat.type = modernStatsTypes[stat.type] || stat.type;\n            });\n          } catch (e) {\n            if (e.name !== 'TypeError') {\n              throw e;\n            } // Avoid TypeError: \"type\" is read-only, in old versions. 34-43ish\n\n\n            stats.forEach(function (stat, i) {\n              stats.set(i, Object.assign({}, stat, {\n                type: modernStatsTypes[stat.type] || stat.type\n              }));\n            });\n          }\n        }\n\n        return stats;\n      }).then(onSucc, onErr);\n    };\n  },\n  shimSenderGetStats: function (window) {\n    if (!(typeof window === 'object' && window.RTCPeerConnection && window.RTCRtpSender)) {\n      return;\n    }\n\n    if (window.RTCRtpSender && 'getStats' in window.RTCRtpSender.prototype) {\n      return;\n    }\n\n    var origGetSenders = window.RTCPeerConnection.prototype.getSenders;\n\n    if (origGetSenders) {\n      window.RTCPeerConnection.prototype.getSenders = function () {\n        var pc = this;\n        var senders = origGetSenders.apply(pc, []);\n        senders.forEach(function (sender) {\n          sender._pc = pc;\n        });\n        return senders;\n      };\n    }\n\n    var origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n\n    if (origAddTrack) {\n      window.RTCPeerConnection.prototype.addTrack = function () {\n        var sender = origAddTrack.apply(this, arguments);\n        sender._pc = this;\n        return sender;\n      };\n    }\n\n    window.RTCRtpSender.prototype.getStats = function () {\n      return this.track ? this._pc.getStats(this.track) : Promise.resolve(new Map());\n    };\n  },\n  shimReceiverGetStats: function (window) {\n    if (!(typeof window === 'object' && window.RTCPeerConnection && window.RTCRtpSender)) {\n      return;\n    }\n\n    if (window.RTCRtpSender && 'getStats' in window.RTCRtpReceiver.prototype) {\n      return;\n    }\n\n    var origGetReceivers = window.RTCPeerConnection.prototype.getReceivers;\n\n    if (origGetReceivers) {\n      window.RTCPeerConnection.prototype.getReceivers = function () {\n        var pc = this;\n        var receivers = origGetReceivers.apply(pc, []);\n        receivers.forEach(function (receiver) {\n          receiver._pc = pc;\n        });\n        return receivers;\n      };\n    }\n\n    utils.wrapPeerConnectionEvent(window, 'track', function (e) {\n      e.receiver._pc = e.srcElement;\n      return e;\n    });\n\n    window.RTCRtpReceiver.prototype.getStats = function () {\n      return this._pc.getStats(this.track);\n    };\n  },\n  shimRemoveStream: function (window) {\n    if (!window.RTCPeerConnection || 'removeStream' in window.RTCPeerConnection.prototype) {\n      return;\n    }\n\n    window.RTCPeerConnection.prototype.removeStream = function (stream) {\n      var pc = this;\n      utils.deprecated('removeStream', 'removeTrack');\n      this.getSenders().forEach(function (sender) {\n        if (sender.track && stream.getTracks().indexOf(sender.track) !== -1) {\n          pc.removeTrack(sender);\n        }\n      });\n    };\n  },\n  shimRTCDataChannel: function (window) {\n    // rename DataChannel to RTCDataChannel (native fix in FF60):\n    // https://bugzilla.mozilla.org/show_bug.cgi?id=1173851\n    if (window.DataChannel && !window.RTCDataChannel) {\n      window.RTCDataChannel = window.DataChannel;\n    }\n  },\n  shimGetDisplayMedia: function (window, preferredMediaSource) {\n    if (!window.navigator || !window.navigator.mediaDevices || 'getDisplayMedia' in window.navigator.mediaDevices) {\n      return;\n    }\n\n    window.navigator.mediaDevices.getDisplayMedia = function (constraints) {\n      if (!(constraints && constraints.video)) {\n        var err = new DOMException('getDisplayMedia without video ' + 'constraints is undefined');\n        err.name = 'NotFoundError'; // from https://heycam.github.io/webidl/#idl-DOMException-error-names\n\n        err.code = 8;\n        return Promise.reject(err);\n      }\n\n      if (constraints.video === true) {\n        constraints.video = {\n          mediaSource: preferredMediaSource\n        };\n      } else {\n        constraints.video.mediaSource = preferredMediaSource;\n      }\n\n      return window.navigator.mediaDevices.getUserMedia(constraints);\n    };\n\n    window.navigator.getDisplayMedia = function (constraints) {\n      utils.deprecated('navigator.getDisplayMedia', 'navigator.mediaDevices.getDisplayMedia');\n      return window.navigator.mediaDevices.getDisplayMedia(constraints);\n    };\n  }\n};","map":{"version":3,"sources":["/home/ryan/dev/defi/shadowtoken2/node_modules/@myetherwallet/mewconnect-web-client/node_modules/webrtc-adapter/src/js/firefox/firefox_shim.js"],"names":["utils","require","module","exports","shimGetUserMedia","shimOnTrack","window","RTCPeerConnection","prototype","Object","defineProperty","get","_ontrack","set","f","removeEventListener","_ontrackpoly","addEventListener","e","stream","getTracks","forEach","track","event","Event","receiver","transceiver","streams","dispatchEvent","bind","enumerable","configurable","RTCTrackEvent","shimSourceObject","HTMLMediaElement","mozSrcObject","shimPeerConnection","browserDetails","detectBrowser","mozRTCPeerConnection","pcConfig","pcConstraints","version","iceServers","newIceServers","i","length","server","hasOwnProperty","j","urls","newServer","url","indexOf","username","credential","push","generateCertificate","RTCSessionDescription","mozRTCSessionDescription","RTCIceCandidate","mozRTCIceCandidate","method","nativeMethod","arguments","apply","nativeAddIceCandidate","addIceCandidate","Promise","resolve","makeMapStats","stats","map","Map","keys","key","modernStatsTypes","inboundrtp","outboundrtp","candidatepair","localcandidate","remotecandidate","nativeGetStats","getStats","selector","onSucc","onErr","then","stat","type","name","assign","shimSenderGetStats","RTCRtpSender","origGetSenders","getSenders","pc","senders","sender","_pc","origAddTrack","addTrack","shimReceiverGetStats","RTCRtpReceiver","origGetReceivers","getReceivers","receivers","wrapPeerConnectionEvent","srcElement","shimRemoveStream","removeStream","deprecated","removeTrack","shimRTCDataChannel","DataChannel","RTCDataChannel","shimGetDisplayMedia","preferredMediaSource","navigator","mediaDevices","getDisplayMedia","constraints","video","err","DOMException","code","reject","mediaSource","getUserMedia"],"mappings":"AAAA;;;;;;;;AAOC;AACD;;AAEA,IAAIA,KAAK,GAAGC,OAAO,CAAC,UAAD,CAAnB;;AAEAC,MAAM,CAACC,OAAP,GAAiB;AACfC,EAAAA,gBAAgB,EAAEH,OAAO,CAAC,gBAAD,CADV;AAEfI,EAAAA,WAAW,EAAE,UAASC,MAAT,EAAiB;AAC5B,QAAI,OAAOA,MAAP,KAAkB,QAAlB,IAA8BA,MAAM,CAACC,iBAArC,IAA0D,EAAE,aAC5DD,MAAM,CAACC,iBAAP,CAAyBC,SADiC,CAA9D,EACyC;AACvCC,MAAAA,MAAM,CAACC,cAAP,CAAsBJ,MAAM,CAACC,iBAAP,CAAyBC,SAA/C,EAA0D,SAA1D,EAAqE;AACnEG,QAAAA,GAAG,EAAE,YAAW;AACd,iBAAO,KAAKC,QAAZ;AACD,SAHkE;AAInEC,QAAAA,GAAG,EAAE,UAASC,CAAT,EAAY;AACf,cAAI,KAAKF,QAAT,EAAmB;AACjB,iBAAKG,mBAAL,CAAyB,OAAzB,EAAkC,KAAKH,QAAvC;AACA,iBAAKG,mBAAL,CAAyB,WAAzB,EAAsC,KAAKC,YAA3C;AACD;;AACD,eAAKC,gBAAL,CAAsB,OAAtB,EAA+B,KAAKL,QAAL,GAAgBE,CAA/C;AACA,eAAKG,gBAAL,CAAsB,WAAtB,EAAmC,KAAKD,YAAL,GAAoB,UAASE,CAAT,EAAY;AACjEA,YAAAA,CAAC,CAACC,MAAF,CAASC,SAAT,GAAqBC,OAArB,CAA6B,UAASC,KAAT,EAAgB;AAC3C,kBAAIC,KAAK,GAAG,IAAIC,KAAJ,CAAU,OAAV,CAAZ;AACAD,cAAAA,KAAK,CAACD,KAAN,GAAcA,KAAd;AACAC,cAAAA,KAAK,CAACE,QAAN,GAAiB;AAACH,gBAAAA,KAAK,EAAEA;AAAR,eAAjB;AACAC,cAAAA,KAAK,CAACG,WAAN,GAAoB;AAACD,gBAAAA,QAAQ,EAAEF,KAAK,CAACE;AAAjB,eAApB;AACAF,cAAAA,KAAK,CAACI,OAAN,GAAgB,CAACT,CAAC,CAACC,MAAH,CAAhB;AACA,mBAAKS,aAAL,CAAmBL,KAAnB;AACD,aAP4B,CAO3BM,IAP2B,CAOtB,IAPsB,CAA7B;AAQD,WATsD,CASrDA,IATqD,CAShD,IATgD,CAAvD;AAUD,SApBkE;AAqBnEC,QAAAA,UAAU,EAAE,IArBuD;AAsBnEC,QAAAA,YAAY,EAAE;AAtBqD,OAArE;AAwBD;;AACD,QAAI,OAAOzB,MAAP,KAAkB,QAAlB,IAA8BA,MAAM,CAAC0B,aAArC,IACC,cAAc1B,MAAM,CAAC0B,aAAP,CAAqBxB,SADpC,IAEA,EAAE,iBAAiBF,MAAM,CAAC0B,aAAP,CAAqBxB,SAAxC,CAFJ,EAEwD;AACtDC,MAAAA,MAAM,CAACC,cAAP,CAAsBJ,MAAM,CAAC0B,aAAP,CAAqBxB,SAA3C,EAAsD,aAAtD,EAAqE;AACnEG,QAAAA,GAAG,EAAE,YAAW;AACd,iBAAO;AAACc,YAAAA,QAAQ,EAAE,KAAKA;AAAhB,WAAP;AACD;AAHkE,OAArE;AAKD;AACF,GAvCc;AAyCfQ,EAAAA,gBAAgB,EAAE,UAAS3B,MAAT,EAAiB;AACjC;AACA,QAAI,OAAOA,MAAP,KAAkB,QAAtB,EAAgC;AAC9B,UAAIA,MAAM,CAAC4B,gBAAP,IACF,EAAE,eAAe5B,MAAM,CAAC4B,gBAAP,CAAwB1B,SAAzC,CADF,EACuD;AACrD;AACAC,QAAAA,MAAM,CAACC,cAAP,CAAsBJ,MAAM,CAAC4B,gBAAP,CAAwB1B,SAA9C,EAAyD,WAAzD,EAAsE;AACpEG,UAAAA,GAAG,EAAE,YAAW;AACd,mBAAO,KAAKwB,YAAZ;AACD,WAHmE;AAIpEtB,UAAAA,GAAG,EAAE,UAASM,MAAT,EAAiB;AACpB,iBAAKgB,YAAL,GAAoBhB,MAApB;AACD;AANmE,SAAtE;AAQD;AACF;AACF,GAzDc;AA2DfiB,EAAAA,kBAAkB,EAAE,UAAS9B,MAAT,EAAiB;AACnC,QAAI+B,cAAc,GAAGrC,KAAK,CAACsC,aAAN,CAAoBhC,MAApB,CAArB;;AAEA,QAAI,OAAOA,MAAP,KAAkB,QAAlB,IAA8B,EAAEA,MAAM,CAACC,iBAAP,IAChCD,MAAM,CAACiC,oBADuB,CAAlC,EACkC;AAChC,aADgC,CACxB;AACT,KANkC,CAOnC;;;AACA,QAAI,CAACjC,MAAM,CAACC,iBAAZ,EAA+B;AAC7BD,MAAAA,MAAM,CAACC,iBAAP,GAA2B,UAASiC,QAAT,EAAmBC,aAAnB,EAAkC;AAC3D,YAAIJ,cAAc,CAACK,OAAf,GAAyB,EAA7B,EAAiC;AAC/B;AACA;AACA,cAAIF,QAAQ,IAAIA,QAAQ,CAACG,UAAzB,EAAqC;AACnC,gBAAIC,aAAa,GAAG,EAApB;;AACA,iBAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGL,QAAQ,CAACG,UAAT,CAAoBG,MAAxC,EAAgDD,CAAC,EAAjD,EAAqD;AACnD,kBAAIE,MAAM,GAAGP,QAAQ,CAACG,UAAT,CAAoBE,CAApB,CAAb;;AACA,kBAAIE,MAAM,CAACC,cAAP,CAAsB,MAAtB,CAAJ,EAAmC;AACjC,qBAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,MAAM,CAACG,IAAP,CAAYJ,MAAhC,EAAwCG,CAAC,EAAzC,EAA6C;AAC3C,sBAAIE,SAAS,GAAG;AACdC,oBAAAA,GAAG,EAAEL,MAAM,CAACG,IAAP,CAAYD,CAAZ;AADS,mBAAhB;;AAGA,sBAAIF,MAAM,CAACG,IAAP,CAAYD,CAAZ,EAAeI,OAAf,CAAuB,MAAvB,MAAmC,CAAvC,EAA0C;AACxCF,oBAAAA,SAAS,CAACG,QAAV,GAAqBP,MAAM,CAACO,QAA5B;AACAH,oBAAAA,SAAS,CAACI,UAAV,GAAuBR,MAAM,CAACQ,UAA9B;AACD;;AACDX,kBAAAA,aAAa,CAACY,IAAd,CAAmBL,SAAnB;AACD;AACF,eAXD,MAWO;AACLP,gBAAAA,aAAa,CAACY,IAAd,CAAmBhB,QAAQ,CAACG,UAAT,CAAoBE,CAApB,CAAnB;AACD;AACF;;AACDL,YAAAA,QAAQ,CAACG,UAAT,GAAsBC,aAAtB;AACD;AACF;;AACD,eAAO,IAAItC,MAAM,CAACiC,oBAAX,CAAgCC,QAAhC,EAA0CC,aAA1C,CAAP;AACD,OA3BD;;AA4BAnC,MAAAA,MAAM,CAACC,iBAAP,CAAyBC,SAAzB,GACIF,MAAM,CAACiC,oBAAP,CAA4B/B,SADhC,CA7B6B,CAgC7B;;AACA,UAAIF,MAAM,CAACiC,oBAAP,CAA4BkB,mBAAhC,EAAqD;AACnDhD,QAAAA,MAAM,CAACC,cAAP,CAAsBJ,MAAM,CAACC,iBAA7B,EAAgD,qBAAhD,EAAuE;AACrEI,UAAAA,GAAG,EAAE,YAAW;AACd,mBAAOL,MAAM,CAACiC,oBAAP,CAA4BkB,mBAAnC;AACD;AAHoE,SAAvE;AAKD;;AAEDnD,MAAAA,MAAM,CAACoD,qBAAP,GAA+BpD,MAAM,CAACqD,wBAAtC;AACArD,MAAAA,MAAM,CAACsD,eAAP,GAAyBtD,MAAM,CAACuD,kBAAhC;AACD,KAnDkC,CAqDnC;;;AACA,KAAC,qBAAD,EAAwB,sBAAxB,EAAgD,iBAAhD,EACKxC,OADL,CACa,UAASyC,MAAT,EAAiB;AACxB,UAAIC,YAAY,GAAGzD,MAAM,CAACC,iBAAP,CAAyBC,SAAzB,CAAmCsD,MAAnC,CAAnB;;AACAxD,MAAAA,MAAM,CAACC,iBAAP,CAAyBC,SAAzB,CAAmCsD,MAAnC,IAA6C,YAAW;AACtDE,QAAAA,SAAS,CAAC,CAAD,CAAT,GAAe,KAAMF,MAAM,KAAK,iBAAZ,GAChBxD,MAAM,CAACsD,eADS,GAEhBtD,MAAM,CAACoD,qBAFI,EAEmBM,SAAS,CAAC,CAAD,CAF5B,CAAf;AAGA,eAAOD,YAAY,CAACE,KAAb,CAAmB,IAAnB,EAAyBD,SAAzB,CAAP;AACD,OALD;AAMD,KATL,EAtDmC,CAiEnC;;AACA,QAAIE,qBAAqB,GACrB5D,MAAM,CAACC,iBAAP,CAAyBC,SAAzB,CAAmC2D,eADvC;;AAEA7D,IAAAA,MAAM,CAACC,iBAAP,CAAyBC,SAAzB,CAAmC2D,eAAnC,GAAqD,YAAW;AAC9D,UAAI,CAACH,SAAS,CAAC,CAAD,CAAd,EAAmB;AACjB,YAAIA,SAAS,CAAC,CAAD,CAAb,EAAkB;AAChBA,UAAAA,SAAS,CAAC,CAAD,CAAT,CAAaC,KAAb,CAAmB,IAAnB;AACD;;AACD,eAAOG,OAAO,CAACC,OAAR,EAAP;AACD;;AACD,aAAOH,qBAAqB,CAACD,KAAtB,CAA4B,IAA5B,EAAkCD,SAAlC,CAAP;AACD,KARD,CApEmC,CA8EnC;;;AACA,QAAIM,YAAY,GAAG,UAASC,KAAT,EAAgB;AACjC,UAAIC,GAAG,GAAG,IAAIC,GAAJ,EAAV;AACAhE,MAAAA,MAAM,CAACiE,IAAP,CAAYH,KAAZ,EAAmBlD,OAAnB,CAA2B,UAASsD,GAAT,EAAc;AACvCH,QAAAA,GAAG,CAAC3D,GAAJ,CAAQ8D,GAAR,EAAaJ,KAAK,CAACI,GAAD,CAAlB;AACAH,QAAAA,GAAG,CAACG,GAAD,CAAH,GAAWJ,KAAK,CAACI,GAAD,CAAhB;AACD,OAHD;AAIA,aAAOH,GAAP;AACD,KAPD;;AASA,QAAII,gBAAgB,GAAG;AACrBC,MAAAA,UAAU,EAAE,aADS;AAErBC,MAAAA,WAAW,EAAE,cAFQ;AAGrBC,MAAAA,aAAa,EAAE,gBAHM;AAIrBC,MAAAA,cAAc,EAAE,iBAJK;AAKrBC,MAAAA,eAAe,EAAE;AALI,KAAvB;AAQA,QAAIC,cAAc,GAAG5E,MAAM,CAACC,iBAAP,CAAyBC,SAAzB,CAAmC2E,QAAxD;;AACA7E,IAAAA,MAAM,CAACC,iBAAP,CAAyBC,SAAzB,CAAmC2E,QAAnC,GAA8C,UAC5CC,QAD4C,EAE5CC,MAF4C,EAG5CC,KAH4C,EAI5C;AACA,aAAOJ,cAAc,CAACjB,KAAf,CAAqB,IAArB,EAA2B,CAACmB,QAAQ,IAAI,IAAb,CAA3B,EACJG,IADI,CACC,UAAShB,KAAT,EAAgB;AACpB,YAAIlC,cAAc,CAACK,OAAf,GAAyB,EAA7B,EAAiC;AAC/B6B,UAAAA,KAAK,GAAGD,YAAY,CAACC,KAAD,CAApB;AACD;;AACD,YAAIlC,cAAc,CAACK,OAAf,GAAyB,EAAzB,IAA+B,CAAC2C,MAApC,EAA4C;AAC1C;AACA;AACA,cAAI;AACFd,YAAAA,KAAK,CAAClD,OAAN,CAAc,UAASmE,IAAT,EAAe;AAC3BA,cAAAA,IAAI,CAACC,IAAL,GAAYb,gBAAgB,CAACY,IAAI,CAACC,IAAN,CAAhB,IAA+BD,IAAI,CAACC,IAAhD;AACD,aAFD;AAGD,WAJD,CAIE,OAAOvE,CAAP,EAAU;AACV,gBAAIA,CAAC,CAACwE,IAAF,KAAW,WAAf,EAA4B;AAC1B,oBAAMxE,CAAN;AACD,aAHS,CAIV;;;AACAqD,YAAAA,KAAK,CAAClD,OAAN,CAAc,UAASmE,IAAT,EAAe3C,CAAf,EAAkB;AAC9B0B,cAAAA,KAAK,CAAC1D,GAAN,CAAUgC,CAAV,EAAapC,MAAM,CAACkF,MAAP,CAAc,EAAd,EAAkBH,IAAlB,EAAwB;AACnCC,gBAAAA,IAAI,EAAEb,gBAAgB,CAACY,IAAI,CAACC,IAAN,CAAhB,IAA+BD,IAAI,CAACC;AADP,eAAxB,CAAb;AAGD,aAJD;AAKD;AACF;;AACD,eAAOlB,KAAP;AACD,OAzBI,EA0BJgB,IA1BI,CA0BCF,MA1BD,EA0BSC,KA1BT,CAAP;AA2BD,KAhCD;AAiCD,GA7Lc;AA+LfM,EAAAA,kBAAkB,EAAE,UAAStF,MAAT,EAAiB;AACnC,QAAI,EAAE,OAAOA,MAAP,KAAkB,QAAlB,IAA8BA,MAAM,CAACC,iBAArC,IACFD,MAAM,CAACuF,YADP,CAAJ,EAC0B;AACxB;AACD;;AACD,QAAIvF,MAAM,CAACuF,YAAP,IAAuB,cAAcvF,MAAM,CAACuF,YAAP,CAAoBrF,SAA7D,EAAwE;AACtE;AACD;;AACD,QAAIsF,cAAc,GAAGxF,MAAM,CAACC,iBAAP,CAAyBC,SAAzB,CAAmCuF,UAAxD;;AACA,QAAID,cAAJ,EAAoB;AAClBxF,MAAAA,MAAM,CAACC,iBAAP,CAAyBC,SAAzB,CAAmCuF,UAAnC,GAAgD,YAAW;AACzD,YAAIC,EAAE,GAAG,IAAT;AACA,YAAIC,OAAO,GAAGH,cAAc,CAAC7B,KAAf,CAAqB+B,EAArB,EAAyB,EAAzB,CAAd;AACAC,QAAAA,OAAO,CAAC5E,OAAR,CAAgB,UAAS6E,MAAT,EAAiB;AAC/BA,UAAAA,MAAM,CAACC,GAAP,GAAaH,EAAb;AACD,SAFD;AAGA,eAAOC,OAAP;AACD,OAPD;AAQD;;AAED,QAAIG,YAAY,GAAG9F,MAAM,CAACC,iBAAP,CAAyBC,SAAzB,CAAmC6F,QAAtD;;AACA,QAAID,YAAJ,EAAkB;AAChB9F,MAAAA,MAAM,CAACC,iBAAP,CAAyBC,SAAzB,CAAmC6F,QAAnC,GAA8C,YAAW;AACvD,YAAIH,MAAM,GAAGE,YAAY,CAACnC,KAAb,CAAmB,IAAnB,EAAyBD,SAAzB,CAAb;AACAkC,QAAAA,MAAM,CAACC,GAAP,GAAa,IAAb;AACA,eAAOD,MAAP;AACD,OAJD;AAKD;;AACD5F,IAAAA,MAAM,CAACuF,YAAP,CAAoBrF,SAApB,CAA8B2E,QAA9B,GAAyC,YAAW;AAClD,aAAO,KAAK7D,KAAL,GAAa,KAAK6E,GAAL,CAAShB,QAAT,CAAkB,KAAK7D,KAAvB,CAAb,GACH8C,OAAO,CAACC,OAAR,CAAgB,IAAII,GAAJ,EAAhB,CADJ;AAED,KAHD;AAID,GA/Nc;AAiOf6B,EAAAA,oBAAoB,EAAE,UAAShG,MAAT,EAAiB;AACrC,QAAI,EAAE,OAAOA,MAAP,KAAkB,QAAlB,IAA8BA,MAAM,CAACC,iBAArC,IACFD,MAAM,CAACuF,YADP,CAAJ,EAC0B;AACxB;AACD;;AACD,QAAIvF,MAAM,CAACuF,YAAP,IAAuB,cAAcvF,MAAM,CAACiG,cAAP,CAAsB/F,SAA/D,EAA0E;AACxE;AACD;;AACD,QAAIgG,gBAAgB,GAAGlG,MAAM,CAACC,iBAAP,CAAyBC,SAAzB,CAAmCiG,YAA1D;;AACA,QAAID,gBAAJ,EAAsB;AACpBlG,MAAAA,MAAM,CAACC,iBAAP,CAAyBC,SAAzB,CAAmCiG,YAAnC,GAAkD,YAAW;AAC3D,YAAIT,EAAE,GAAG,IAAT;AACA,YAAIU,SAAS,GAAGF,gBAAgB,CAACvC,KAAjB,CAAuB+B,EAAvB,EAA2B,EAA3B,CAAhB;AACAU,QAAAA,SAAS,CAACrF,OAAV,CAAkB,UAASI,QAAT,EAAmB;AACnCA,UAAAA,QAAQ,CAAC0E,GAAT,GAAeH,EAAf;AACD,SAFD;AAGA,eAAOU,SAAP;AACD,OAPD;AAQD;;AACD1G,IAAAA,KAAK,CAAC2G,uBAAN,CAA8BrG,MAA9B,EAAsC,OAAtC,EAA+C,UAASY,CAAT,EAAY;AACzDA,MAAAA,CAAC,CAACO,QAAF,CAAW0E,GAAX,GAAiBjF,CAAC,CAAC0F,UAAnB;AACA,aAAO1F,CAAP;AACD,KAHD;;AAIAZ,IAAAA,MAAM,CAACiG,cAAP,CAAsB/F,SAAtB,CAAgC2E,QAAhC,GAA2C,YAAW;AACpD,aAAO,KAAKgB,GAAL,CAAShB,QAAT,CAAkB,KAAK7D,KAAvB,CAAP;AACD,KAFD;AAGD,GA3Pc;AA6PfuF,EAAAA,gBAAgB,EAAE,UAASvG,MAAT,EAAiB;AACjC,QAAI,CAACA,MAAM,CAACC,iBAAR,IACA,kBAAkBD,MAAM,CAACC,iBAAP,CAAyBC,SAD/C,EAC0D;AACxD;AACD;;AACDF,IAAAA,MAAM,CAACC,iBAAP,CAAyBC,SAAzB,CAAmCsG,YAAnC,GAAkD,UAAS3F,MAAT,EAAiB;AACjE,UAAI6E,EAAE,GAAG,IAAT;AACAhG,MAAAA,KAAK,CAAC+G,UAAN,CAAiB,cAAjB,EAAiC,aAAjC;AACA,WAAKhB,UAAL,GAAkB1E,OAAlB,CAA0B,UAAS6E,MAAT,EAAiB;AACzC,YAAIA,MAAM,CAAC5E,KAAP,IAAgBH,MAAM,CAACC,SAAP,GAAmBiC,OAAnB,CAA2B6C,MAAM,CAAC5E,KAAlC,MAA6C,CAAC,CAAlE,EAAqE;AACnE0E,UAAAA,EAAE,CAACgB,WAAH,CAAed,MAAf;AACD;AACF,OAJD;AAKD,KARD;AASD,GA3Qc;AA6Qfe,EAAAA,kBAAkB,EAAE,UAAS3G,MAAT,EAAiB;AACnC;AACA;AACA,QAAIA,MAAM,CAAC4G,WAAP,IAAsB,CAAC5G,MAAM,CAAC6G,cAAlC,EAAkD;AAChD7G,MAAAA,MAAM,CAAC6G,cAAP,GAAwB7G,MAAM,CAAC4G,WAA/B;AACD;AACF,GAnRc;AAqRfE,EAAAA,mBAAmB,EAAE,UAAS9G,MAAT,EAAiB+G,oBAAjB,EAAuC;AAC1D,QAAI,CAAC/G,MAAM,CAACgH,SAAR,IAAqB,CAAChH,MAAM,CAACgH,SAAP,CAAiBC,YAAvC,IACA,qBAAqBjH,MAAM,CAACgH,SAAP,CAAiBC,YAD1C,EACwD;AACtD;AACD;;AACDjH,IAAAA,MAAM,CAACgH,SAAP,CAAiBC,YAAjB,CAA8BC,eAA9B,GAAgD,UAASC,WAAT,EAAsB;AACpE,UAAI,EAAEA,WAAW,IAAIA,WAAW,CAACC,KAA7B,CAAJ,EAAyC;AACvC,YAAIC,GAAG,GAAG,IAAIC,YAAJ,CAAiB,mCACvB,0BADM,CAAV;AAEAD,QAAAA,GAAG,CAACjC,IAAJ,GAAW,eAAX,CAHuC,CAIvC;;AACAiC,QAAAA,GAAG,CAACE,IAAJ,GAAW,CAAX;AACA,eAAOzD,OAAO,CAAC0D,MAAR,CAAeH,GAAf,CAAP;AACD;;AACD,UAAIF,WAAW,CAACC,KAAZ,KAAsB,IAA1B,EAAgC;AAC9BD,QAAAA,WAAW,CAACC,KAAZ,GAAoB;AAACK,UAAAA,WAAW,EAAEV;AAAd,SAApB;AACD,OAFD,MAEO;AACLI,QAAAA,WAAW,CAACC,KAAZ,CAAkBK,WAAlB,GAAgCV,oBAAhC;AACD;;AACD,aAAO/G,MAAM,CAACgH,SAAP,CAAiBC,YAAjB,CAA8BS,YAA9B,CAA2CP,WAA3C,CAAP;AACD,KAfD;;AAgBAnH,IAAAA,MAAM,CAACgH,SAAP,CAAiBE,eAAjB,GAAmC,UAASC,WAAT,EAAsB;AACvDzH,MAAAA,KAAK,CAAC+G,UAAN,CAAiB,2BAAjB,EACI,wCADJ;AAEA,aAAOzG,MAAM,CAACgH,SAAP,CAAiBC,YAAjB,CAA8BC,eAA9B,CAA8CC,WAA9C,CAAP;AACD,KAJD;AAKD;AA/Sc,CAAjB","sourcesContent":["/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar utils = require('../utils');\n\nmodule.exports = {\n  shimGetUserMedia: require('./getusermedia'),\n  shimOnTrack: function(window) {\n    if (typeof window === 'object' && window.RTCPeerConnection && !('ontrack' in\n        window.RTCPeerConnection.prototype)) {\n      Object.defineProperty(window.RTCPeerConnection.prototype, 'ontrack', {\n        get: function() {\n          return this._ontrack;\n        },\n        set: function(f) {\n          if (this._ontrack) {\n            this.removeEventListener('track', this._ontrack);\n            this.removeEventListener('addstream', this._ontrackpoly);\n          }\n          this.addEventListener('track', this._ontrack = f);\n          this.addEventListener('addstream', this._ontrackpoly = function(e) {\n            e.stream.getTracks().forEach(function(track) {\n              var event = new Event('track');\n              event.track = track;\n              event.receiver = {track: track};\n              event.transceiver = {receiver: event.receiver};\n              event.streams = [e.stream];\n              this.dispatchEvent(event);\n            }.bind(this));\n          }.bind(this));\n        },\n        enumerable: true,\n        configurable: true\n      });\n    }\n    if (typeof window === 'object' && window.RTCTrackEvent &&\n        ('receiver' in window.RTCTrackEvent.prototype) &&\n        !('transceiver' in window.RTCTrackEvent.prototype)) {\n      Object.defineProperty(window.RTCTrackEvent.prototype, 'transceiver', {\n        get: function() {\n          return {receiver: this.receiver};\n        }\n      });\n    }\n  },\n\n  shimSourceObject: function(window) {\n    // Firefox has supported mozSrcObject since FF22, unprefixed in 42.\n    if (typeof window === 'object') {\n      if (window.HTMLMediaElement &&\n        !('srcObject' in window.HTMLMediaElement.prototype)) {\n        // Shim the srcObject property, once, when HTMLMediaElement is found.\n        Object.defineProperty(window.HTMLMediaElement.prototype, 'srcObject', {\n          get: function() {\n            return this.mozSrcObject;\n          },\n          set: function(stream) {\n            this.mozSrcObject = stream;\n          }\n        });\n      }\n    }\n  },\n\n  shimPeerConnection: function(window) {\n    var browserDetails = utils.detectBrowser(window);\n\n    if (typeof window !== 'object' || !(window.RTCPeerConnection ||\n        window.mozRTCPeerConnection)) {\n      return; // probably media.peerconnection.enabled=false in about:config\n    }\n    // The RTCPeerConnection object.\n    if (!window.RTCPeerConnection) {\n      window.RTCPeerConnection = function(pcConfig, pcConstraints) {\n        if (browserDetails.version < 38) {\n          // .urls is not supported in FF < 38.\n          // create RTCIceServers with a single url.\n          if (pcConfig && pcConfig.iceServers) {\n            var newIceServers = [];\n            for (var i = 0; i < pcConfig.iceServers.length; i++) {\n              var server = pcConfig.iceServers[i];\n              if (server.hasOwnProperty('urls')) {\n                for (var j = 0; j < server.urls.length; j++) {\n                  var newServer = {\n                    url: server.urls[j]\n                  };\n                  if (server.urls[j].indexOf('turn') === 0) {\n                    newServer.username = server.username;\n                    newServer.credential = server.credential;\n                  }\n                  newIceServers.push(newServer);\n                }\n              } else {\n                newIceServers.push(pcConfig.iceServers[i]);\n              }\n            }\n            pcConfig.iceServers = newIceServers;\n          }\n        }\n        return new window.mozRTCPeerConnection(pcConfig, pcConstraints);\n      };\n      window.RTCPeerConnection.prototype =\n          window.mozRTCPeerConnection.prototype;\n\n      // wrap static methods. Currently just generateCertificate.\n      if (window.mozRTCPeerConnection.generateCertificate) {\n        Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\n          get: function() {\n            return window.mozRTCPeerConnection.generateCertificate;\n          }\n        });\n      }\n\n      window.RTCSessionDescription = window.mozRTCSessionDescription;\n      window.RTCIceCandidate = window.mozRTCIceCandidate;\n    }\n\n    // shim away need for obsolete RTCIceCandidate/RTCSessionDescription.\n    ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate']\n        .forEach(function(method) {\n          var nativeMethod = window.RTCPeerConnection.prototype[method];\n          window.RTCPeerConnection.prototype[method] = function() {\n            arguments[0] = new ((method === 'addIceCandidate') ?\n                window.RTCIceCandidate :\n                window.RTCSessionDescription)(arguments[0]);\n            return nativeMethod.apply(this, arguments);\n          };\n        });\n\n    // support for addIceCandidate(null or undefined)\n    var nativeAddIceCandidate =\n        window.RTCPeerConnection.prototype.addIceCandidate;\n    window.RTCPeerConnection.prototype.addIceCandidate = function() {\n      if (!arguments[0]) {\n        if (arguments[1]) {\n          arguments[1].apply(null);\n        }\n        return Promise.resolve();\n      }\n      return nativeAddIceCandidate.apply(this, arguments);\n    };\n\n    // shim getStats with maplike support\n    var makeMapStats = function(stats) {\n      var map = new Map();\n      Object.keys(stats).forEach(function(key) {\n        map.set(key, stats[key]);\n        map[key] = stats[key];\n      });\n      return map;\n    };\n\n    var modernStatsTypes = {\n      inboundrtp: 'inbound-rtp',\n      outboundrtp: 'outbound-rtp',\n      candidatepair: 'candidate-pair',\n      localcandidate: 'local-candidate',\n      remotecandidate: 'remote-candidate'\n    };\n\n    var nativeGetStats = window.RTCPeerConnection.prototype.getStats;\n    window.RTCPeerConnection.prototype.getStats = function(\n      selector,\n      onSucc,\n      onErr\n    ) {\n      return nativeGetStats.apply(this, [selector || null])\n        .then(function(stats) {\n          if (browserDetails.version < 48) {\n            stats = makeMapStats(stats);\n          }\n          if (browserDetails.version < 53 && !onSucc) {\n            // Shim only promise getStats with spec-hyphens in type names\n            // Leave callback version alone; misc old uses of forEach before Map\n            try {\n              stats.forEach(function(stat) {\n                stat.type = modernStatsTypes[stat.type] || stat.type;\n              });\n            } catch (e) {\n              if (e.name !== 'TypeError') {\n                throw e;\n              }\n              // Avoid TypeError: \"type\" is read-only, in old versions. 34-43ish\n              stats.forEach(function(stat, i) {\n                stats.set(i, Object.assign({}, stat, {\n                  type: modernStatsTypes[stat.type] || stat.type\n                }));\n              });\n            }\n          }\n          return stats;\n        })\n        .then(onSucc, onErr);\n    };\n  },\n\n  shimSenderGetStats: function(window) {\n    if (!(typeof window === 'object' && window.RTCPeerConnection &&\n        window.RTCRtpSender)) {\n      return;\n    }\n    if (window.RTCRtpSender && 'getStats' in window.RTCRtpSender.prototype) {\n      return;\n    }\n    var origGetSenders = window.RTCPeerConnection.prototype.getSenders;\n    if (origGetSenders) {\n      window.RTCPeerConnection.prototype.getSenders = function() {\n        var pc = this;\n        var senders = origGetSenders.apply(pc, []);\n        senders.forEach(function(sender) {\n          sender._pc = pc;\n        });\n        return senders;\n      };\n    }\n\n    var origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n    if (origAddTrack) {\n      window.RTCPeerConnection.prototype.addTrack = function() {\n        var sender = origAddTrack.apply(this, arguments);\n        sender._pc = this;\n        return sender;\n      };\n    }\n    window.RTCRtpSender.prototype.getStats = function() {\n      return this.track ? this._pc.getStats(this.track) :\n          Promise.resolve(new Map());\n    };\n  },\n\n  shimReceiverGetStats: function(window) {\n    if (!(typeof window === 'object' && window.RTCPeerConnection &&\n        window.RTCRtpSender)) {\n      return;\n    }\n    if (window.RTCRtpSender && 'getStats' in window.RTCRtpReceiver.prototype) {\n      return;\n    }\n    var origGetReceivers = window.RTCPeerConnection.prototype.getReceivers;\n    if (origGetReceivers) {\n      window.RTCPeerConnection.prototype.getReceivers = function() {\n        var pc = this;\n        var receivers = origGetReceivers.apply(pc, []);\n        receivers.forEach(function(receiver) {\n          receiver._pc = pc;\n        });\n        return receivers;\n      };\n    }\n    utils.wrapPeerConnectionEvent(window, 'track', function(e) {\n      e.receiver._pc = e.srcElement;\n      return e;\n    });\n    window.RTCRtpReceiver.prototype.getStats = function() {\n      return this._pc.getStats(this.track);\n    };\n  },\n\n  shimRemoveStream: function(window) {\n    if (!window.RTCPeerConnection ||\n        'removeStream' in window.RTCPeerConnection.prototype) {\n      return;\n    }\n    window.RTCPeerConnection.prototype.removeStream = function(stream) {\n      var pc = this;\n      utils.deprecated('removeStream', 'removeTrack');\n      this.getSenders().forEach(function(sender) {\n        if (sender.track && stream.getTracks().indexOf(sender.track) !== -1) {\n          pc.removeTrack(sender);\n        }\n      });\n    };\n  },\n\n  shimRTCDataChannel: function(window) {\n    // rename DataChannel to RTCDataChannel (native fix in FF60):\n    // https://bugzilla.mozilla.org/show_bug.cgi?id=1173851\n    if (window.DataChannel && !window.RTCDataChannel) {\n      window.RTCDataChannel = window.DataChannel;\n    }\n  },\n\n  shimGetDisplayMedia: function(window, preferredMediaSource) {\n    if (!window.navigator || !window.navigator.mediaDevices ||\n        'getDisplayMedia' in window.navigator.mediaDevices) {\n      return;\n    }\n    window.navigator.mediaDevices.getDisplayMedia = function(constraints) {\n      if (!(constraints && constraints.video)) {\n        var err = new DOMException('getDisplayMedia without video ' +\n            'constraints is undefined');\n        err.name = 'NotFoundError';\n        // from https://heycam.github.io/webidl/#idl-DOMException-error-names\n        err.code = 8;\n        return Promise.reject(err);\n      }\n      if (constraints.video === true) {\n        constraints.video = {mediaSource: preferredMediaSource};\n      } else {\n        constraints.video.mediaSource = preferredMediaSource;\n      }\n      return window.navigator.mediaDevices.getUserMedia(constraints);\n    };\n    window.navigator.getDisplayMedia = function(constraints) {\n      utils.deprecated('navigator.getDisplayMedia',\n          'navigator.mediaDevices.getDisplayMedia');\n      return window.navigator.mediaDevices.getDisplayMedia(constraints);\n    };\n  }\n};\n"]},"metadata":{},"sourceType":"script"}