{"ast":null,"code":"'use strict';\n\nvar _ = require('lodash');\n\nvar BN = require('../crypto/bn');\n\nvar buffer = require('buffer');\n\nvar bufferUtil = require('../util/buffer');\n\nvar JSUtil = require('../util/js');\n\nvar BufferWriter = require('../encoding/bufferwriter');\n\nvar Script = require('../script');\n\nvar $ = require('../util/preconditions');\n\nvar errors = require('../errors');\n\nvar MAX_SAFE_INTEGER = 0x1fffffffffffff;\n\nfunction Output(args) {\n  if (!(this instanceof Output)) {\n    return new Output(args);\n  }\n\n  if (_.isObject(args)) {\n    this.satoshis = args.satoshis;\n\n    if (bufferUtil.isBuffer(args.script)) {\n      this._scriptBuffer = args.script;\n    } else {\n      var script;\n\n      if (_.isString(args.script) && JSUtil.isHexa(args.script)) {\n        script = Buffer.from(args.script, 'hex');\n      } else {\n        script = args.script;\n      }\n\n      this.setScript(script);\n    }\n  } else {\n    throw new TypeError('Unrecognized argument for Output');\n  }\n}\n\nObject.defineProperty(Output.prototype, 'script', {\n  configurable: false,\n  enumerable: true,\n  get: function () {\n    if (this._script) {\n      return this._script;\n    } else {\n      this.setScriptFromBuffer(this._scriptBuffer);\n      return this._script;\n    }\n  }\n});\nObject.defineProperty(Output.prototype, 'satoshis', {\n  configurable: false,\n  enumerable: true,\n  get: function () {\n    return this._satoshis;\n  },\n  set: function (num) {\n    if (num instanceof BN) {\n      this._satoshisBN = num;\n      this._satoshis = num.toNumber();\n    } else if (_.isString(num)) {\n      this._satoshis = parseInt(num);\n      this._satoshisBN = BN.fromNumber(this._satoshis);\n    } else {\n      $.checkArgument(JSUtil.isNaturalNumber(num), 'Output satoshis is not a natural number');\n      this._satoshisBN = BN.fromNumber(num);\n      this._satoshis = num;\n    }\n\n    $.checkState(JSUtil.isNaturalNumber(this._satoshis), 'Output satoshis is not a natural number');\n  }\n});\n\nOutput.prototype.invalidSatoshis = function () {\n  if (this._satoshis > MAX_SAFE_INTEGER) {\n    return 'transaction txout satoshis greater than max safe integer';\n  }\n\n  if (this._satoshis !== this._satoshisBN.toNumber()) {\n    return 'transaction txout satoshis has corrupted value';\n  }\n\n  if (this._satoshis < 0) {\n    return 'transaction txout negative';\n  }\n\n  return false;\n};\n\nOutput.prototype.toObject = Output.prototype.toJSON = function toObject() {\n  var obj = {\n    satoshis: this.satoshis\n  };\n  obj.script = this._scriptBuffer.toString('hex');\n  return obj;\n};\n\nOutput.fromObject = function (data) {\n  return new Output(data);\n};\n\nOutput.prototype.setScriptFromBuffer = function (buffer) {\n  this._scriptBuffer = buffer;\n\n  try {\n    this._script = Script.fromBuffer(this._scriptBuffer);\n    this._script._isOutput = true;\n  } catch (e) {\n    if (e instanceof errors.Script.InvalidBuffer) {\n      this._script = null;\n    } else {\n      throw e;\n    }\n  }\n};\n\nOutput.prototype.setScript = function (script) {\n  if (script instanceof Script) {\n    this._scriptBuffer = script.toBuffer();\n    this._script = script;\n    this._script._isOutput = true;\n  } else if (_.isString(script)) {\n    this._script = Script.fromString(script);\n    this._scriptBuffer = this._script.toBuffer();\n    this._script._isOutput = true;\n  } else if (bufferUtil.isBuffer(script)) {\n    this.setScriptFromBuffer(script);\n  } else {\n    throw new TypeError('Invalid argument type: script');\n  }\n\n  return this;\n};\n\nOutput.prototype.inspect = function () {\n  var scriptStr;\n\n  if (this.script) {\n    scriptStr = this.script.inspect();\n  } else {\n    scriptStr = this._scriptBuffer.toString('hex');\n  }\n\n  return '<Output (' + this.satoshis + ' sats) ' + scriptStr + '>';\n};\n\nOutput.fromBufferReader = function (br) {\n  var obj = {};\n  obj.satoshis = br.readUInt64LEBN();\n  var size = br.readVarintNum();\n\n  if (size !== 0) {\n    obj.script = br.read(size);\n  } else {\n    obj.script = Buffer.from([]);\n  }\n\n  return new Output(obj);\n};\n\nOutput.prototype.toBufferWriter = function (writer) {\n  if (!writer) {\n    writer = new BufferWriter();\n  }\n\n  writer.writeUInt64LEBN(this._satoshisBN);\n  var script = this._scriptBuffer;\n  writer.writeVarintNum(script.length);\n  writer.write(script);\n  return writer;\n};\n\nmodule.exports = Output;","map":{"version":3,"sources":["/home/ryan/dev/defi/shadowtoken2/node_modules/bitcore-lib/lib/transaction/output.js"],"names":["_","require","BN","buffer","bufferUtil","JSUtil","BufferWriter","Script","$","errors","MAX_SAFE_INTEGER","Output","args","isObject","satoshis","isBuffer","script","_scriptBuffer","isString","isHexa","Buffer","from","setScript","TypeError","Object","defineProperty","prototype","configurable","enumerable","get","_script","setScriptFromBuffer","_satoshis","set","num","_satoshisBN","toNumber","parseInt","fromNumber","checkArgument","isNaturalNumber","checkState","invalidSatoshis","toObject","toJSON","obj","toString","fromObject","data","fromBuffer","_isOutput","e","InvalidBuffer","toBuffer","fromString","inspect","scriptStr","fromBufferReader","br","readUInt64LEBN","size","readVarintNum","read","toBufferWriter","writer","writeUInt64LEBN","writeVarintNum","length","write","module","exports"],"mappings":"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","sourcesContent":["'use strict';\n\nvar _ = require('lodash');\nvar BN = require('../crypto/bn');\nvar buffer = require('buffer');\nvar bufferUtil = require('../util/buffer');\nvar JSUtil = require('../util/js');\nvar BufferWriter = require('../encoding/bufferwriter');\nvar Script = require('../script');\nvar $ = require('../util/preconditions');\nvar errors = require('../errors');\n\nvar MAX_SAFE_INTEGER = 0x1fffffffffffff;\n\nfunction Output(args) {\n  if (!(this instanceof Output)) {\n    return new Output(args);\n  }\n  if (_.isObject(args)) {\n    this.satoshis = args.satoshis;\n    if (bufferUtil.isBuffer(args.script)) {\n      this._scriptBuffer = args.script;\n    } else {\n      var script;\n      if (_.isString(args.script) && JSUtil.isHexa(args.script)) {\n        script = Buffer.from(args.script, 'hex');\n      } else {\n        script = args.script;\n      }\n      this.setScript(script);\n    }\n  } else {\n    throw new TypeError('Unrecognized argument for Output');\n  }\n}\n\nObject.defineProperty(Output.prototype, 'script', {\n  configurable: false,\n  enumerable: true,\n  get: function() {\n    if (this._script) {\n      return this._script;\n    } else {\n      this.setScriptFromBuffer(this._scriptBuffer);\n      return this._script;\n    }\n\n  }\n});\n\nObject.defineProperty(Output.prototype, 'satoshis', {\n  configurable: false,\n  enumerable: true,\n  get: function() {\n    return this._satoshis;\n  },\n  set: function(num) {\n    if (num instanceof BN) {\n      this._satoshisBN = num;\n      this._satoshis = num.toNumber();\n    } else if (_.isString(num)) {\n      this._satoshis = parseInt(num);\n      this._satoshisBN = BN.fromNumber(this._satoshis);\n    } else {\n      $.checkArgument(\n        JSUtil.isNaturalNumber(num),\n        'Output satoshis is not a natural number'\n      );\n      this._satoshisBN = BN.fromNumber(num);\n      this._satoshis = num;\n    }\n    $.checkState(\n      JSUtil.isNaturalNumber(this._satoshis),\n      'Output satoshis is not a natural number'\n    );\n  }\n});\n\nOutput.prototype.invalidSatoshis = function() {\n  if (this._satoshis > MAX_SAFE_INTEGER) {\n    return 'transaction txout satoshis greater than max safe integer';\n  }\n  if (this._satoshis !== this._satoshisBN.toNumber()) {\n    return 'transaction txout satoshis has corrupted value';\n  }\n  if (this._satoshis < 0) {\n    return 'transaction txout negative';\n  }\n  return false;\n};\n\nOutput.prototype.toObject = Output.prototype.toJSON = function toObject() {\n  var obj = {\n    satoshis: this.satoshis\n  };\n  obj.script = this._scriptBuffer.toString('hex');\n  return obj;\n};\n\nOutput.fromObject = function(data) {\n  return new Output(data);\n};\n\nOutput.prototype.setScriptFromBuffer = function(buffer) {\n  this._scriptBuffer = buffer;\n  try {\n    this._script = Script.fromBuffer(this._scriptBuffer);\n    this._script._isOutput = true;\n  } catch(e) {\n    if (e instanceof errors.Script.InvalidBuffer) {\n      this._script = null;\n    } else {\n      throw e;\n    }\n  }\n};\n\nOutput.prototype.setScript = function(script) {\n  if (script instanceof Script) {\n    this._scriptBuffer = script.toBuffer();\n    this._script = script;\n    this._script._isOutput = true;\n  } else if (_.isString(script)) {\n    this._script = Script.fromString(script);\n    this._scriptBuffer = this._script.toBuffer();\n    this._script._isOutput = true;\n  } else if (bufferUtil.isBuffer(script)) {\n    this.setScriptFromBuffer(script);\n  } else {\n    throw new TypeError('Invalid argument type: script');\n  }\n  return this;\n};\n\nOutput.prototype.inspect = function() {\n  var scriptStr;\n  if (this.script) {\n    scriptStr = this.script.inspect();\n  } else {\n    scriptStr = this._scriptBuffer.toString('hex');\n  }\n  return '<Output (' + this.satoshis + ' sats) ' + scriptStr + '>';\n};\n\nOutput.fromBufferReader = function(br) {\n  var obj = {};\n  obj.satoshis = br.readUInt64LEBN();\n  var size = br.readVarintNum();\n  if (size !== 0) {\n    obj.script = br.read(size);\n  } else {\n    obj.script = Buffer.from([]);\n  }\n  return new Output(obj);\n};\n\nOutput.prototype.toBufferWriter = function(writer) {\n  if (!writer) {\n    writer = new BufferWriter();\n  }\n  writer.writeUInt64LEBN(this._satoshisBN);\n  var script = this._scriptBuffer;\n  writer.writeVarintNum(script.length);\n  writer.write(script);\n  return writer;\n};\n\nmodule.exports = Output;\n"]},"metadata":{},"sourceType":"script"}