{"ast":null,"code":"/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n'use strict';\n\nvar utils = require('../utils');\n\nmodule.exports = {\n  shimLocalStreamsAPI: function (window) {\n    if (typeof window !== 'object' || !window.RTCPeerConnection) {\n      return;\n    }\n\n    if (!('getLocalStreams' in window.RTCPeerConnection.prototype)) {\n      window.RTCPeerConnection.prototype.getLocalStreams = function () {\n        if (!this._localStreams) {\n          this._localStreams = [];\n        }\n\n        return this._localStreams;\n      };\n    }\n\n    if (!('getStreamById' in window.RTCPeerConnection.prototype)) {\n      window.RTCPeerConnection.prototype.getStreamById = function (id) {\n        var result = null;\n\n        if (this._localStreams) {\n          this._localStreams.forEach(function (stream) {\n            if (stream.id === id) {\n              result = stream;\n            }\n          });\n        }\n\n        if (this._remoteStreams) {\n          this._remoteStreams.forEach(function (stream) {\n            if (stream.id === id) {\n              result = stream;\n            }\n          });\n        }\n\n        return result;\n      };\n    }\n\n    if (!('addStream' in window.RTCPeerConnection.prototype)) {\n      var _addTrack = window.RTCPeerConnection.prototype.addTrack;\n\n      window.RTCPeerConnection.prototype.addStream = function (stream) {\n        if (!this._localStreams) {\n          this._localStreams = [];\n        }\n\n        if (this._localStreams.indexOf(stream) === -1) {\n          this._localStreams.push(stream);\n        }\n\n        var pc = this;\n        stream.getTracks().forEach(function (track) {\n          _addTrack.call(pc, track, stream);\n        });\n      };\n\n      window.RTCPeerConnection.prototype.addTrack = function (track, stream) {\n        if (stream) {\n          if (!this._localStreams) {\n            this._localStreams = [stream];\n          } else if (this._localStreams.indexOf(stream) === -1) {\n            this._localStreams.push(stream);\n          }\n        }\n\n        return _addTrack.call(this, track, stream);\n      };\n    }\n\n    if (!('removeStream' in window.RTCPeerConnection.prototype)) {\n      window.RTCPeerConnection.prototype.removeStream = function (stream) {\n        if (!this._localStreams) {\n          this._localStreams = [];\n        }\n\n        var index = this._localStreams.indexOf(stream);\n\n        if (index === -1) {\n          return;\n        }\n\n        this._localStreams.splice(index, 1);\n\n        var pc = this;\n        var tracks = stream.getTracks();\n        this.getSenders().forEach(function (sender) {\n          if (tracks.indexOf(sender.track) !== -1) {\n            pc.removeTrack(sender);\n          }\n        });\n      };\n    }\n  },\n  shimRemoteStreamsAPI: function (window) {\n    if (typeof window !== 'object' || !window.RTCPeerConnection) {\n      return;\n    }\n\n    if (!('getRemoteStreams' in window.RTCPeerConnection.prototype)) {\n      window.RTCPeerConnection.prototype.getRemoteStreams = function () {\n        return this._remoteStreams ? this._remoteStreams : [];\n      };\n    }\n\n    if (!('onaddstream' in window.RTCPeerConnection.prototype)) {\n      Object.defineProperty(window.RTCPeerConnection.prototype, 'onaddstream', {\n        get: function () {\n          return this._onaddstream;\n        },\n        set: function (f) {\n          if (this._onaddstream) {\n            this.removeEventListener('addstream', this._onaddstream);\n          }\n\n          this.addEventListener('addstream', this._onaddstream = f);\n        }\n      });\n      var origSetRemoteDescription = window.RTCPeerConnection.prototype.setRemoteDescription;\n\n      window.RTCPeerConnection.prototype.setRemoteDescription = function () {\n        var pc = this;\n\n        if (!this._onaddstreampoly) {\n          this.addEventListener('track', this._onaddstreampoly = function (e) {\n            e.streams.forEach(function (stream) {\n              if (!pc._remoteStreams) {\n                pc._remoteStreams = [];\n              }\n\n              if (pc._remoteStreams.indexOf(stream) >= 0) {\n                return;\n              }\n\n              pc._remoteStreams.push(stream);\n\n              var event = new Event('addstream');\n              event.stream = stream;\n              pc.dispatchEvent(event);\n            });\n          });\n        }\n\n        return origSetRemoteDescription.apply(pc, arguments);\n      };\n    }\n  },\n  shimCallbacksAPI: function (window) {\n    if (typeof window !== 'object' || !window.RTCPeerConnection) {\n      return;\n    }\n\n    var prototype = window.RTCPeerConnection.prototype;\n    var createOffer = prototype.createOffer;\n    var createAnswer = prototype.createAnswer;\n    var setLocalDescription = prototype.setLocalDescription;\n    var setRemoteDescription = prototype.setRemoteDescription;\n    var addIceCandidate = prototype.addIceCandidate;\n\n    prototype.createOffer = function (successCallback, failureCallback) {\n      var options = arguments.length >= 2 ? arguments[2] : arguments[0];\n      var promise = createOffer.apply(this, [options]);\n\n      if (!failureCallback) {\n        return promise;\n      }\n\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n\n    prototype.createAnswer = function (successCallback, failureCallback) {\n      var options = arguments.length >= 2 ? arguments[2] : arguments[0];\n      var promise = createAnswer.apply(this, [options]);\n\n      if (!failureCallback) {\n        return promise;\n      }\n\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n\n    var withCallback = function (description, successCallback, failureCallback) {\n      var promise = setLocalDescription.apply(this, [description]);\n\n      if (!failureCallback) {\n        return promise;\n      }\n\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n\n    prototype.setLocalDescription = withCallback;\n\n    withCallback = function (description, successCallback, failureCallback) {\n      var promise = setRemoteDescription.apply(this, [description]);\n\n      if (!failureCallback) {\n        return promise;\n      }\n\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n\n    prototype.setRemoteDescription = withCallback;\n\n    withCallback = function (candidate, successCallback, failureCallback) {\n      var promise = addIceCandidate.apply(this, [candidate]);\n\n      if (!failureCallback) {\n        return promise;\n      }\n\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n\n    prototype.addIceCandidate = withCallback;\n  },\n  shimGetUserMedia: function (window) {\n    var navigator = window && window.navigator;\n\n    if (!navigator.getUserMedia) {\n      if (navigator.webkitGetUserMedia) {\n        navigator.getUserMedia = navigator.webkitGetUserMedia.bind(navigator);\n      } else if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n        navigator.getUserMedia = function (constraints, cb, errcb) {\n          navigator.mediaDevices.getUserMedia(constraints).then(cb, errcb);\n        }.bind(navigator);\n      }\n    }\n  },\n  shimRTCIceServerUrls: function (window) {\n    // migrate from non-spec RTCIceServer.url to RTCIceServer.urls\n    var OrigPeerConnection = window.RTCPeerConnection;\n\n    window.RTCPeerConnection = function (pcConfig, pcConstraints) {\n      if (pcConfig && pcConfig.iceServers) {\n        var newIceServers = [];\n\n        for (var i = 0; i < pcConfig.iceServers.length; i++) {\n          var server = pcConfig.iceServers[i];\n\n          if (!server.hasOwnProperty('urls') && server.hasOwnProperty('url')) {\n            utils.deprecated('RTCIceServer.url', 'RTCIceServer.urls');\n            server = JSON.parse(JSON.stringify(server));\n            server.urls = server.url;\n            delete server.url;\n            newIceServers.push(server);\n          } else {\n            newIceServers.push(pcConfig.iceServers[i]);\n          }\n        }\n\n        pcConfig.iceServers = newIceServers;\n      }\n\n      return new OrigPeerConnection(pcConfig, pcConstraints);\n    };\n\n    window.RTCPeerConnection.prototype = OrigPeerConnection.prototype; // wrap static methods. Currently just generateCertificate.\n\n    if ('generateCertificate' in window.RTCPeerConnection) {\n      Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\n        get: function () {\n          return OrigPeerConnection.generateCertificate;\n        }\n      });\n    }\n  },\n  shimTrackEventTransceiver: function (window) {\n    // Add event.transceiver member over deprecated event.receiver\n    if (typeof window === 'object' && window.RTCPeerConnection && 'receiver' in window.RTCTrackEvent.prototype && // can't check 'transceiver' in window.RTCTrackEvent.prototype, as it is\n    // defined for some reason even when window.RTCTransceiver is not.\n    !window.RTCTransceiver) {\n      Object.defineProperty(window.RTCTrackEvent.prototype, 'transceiver', {\n        get: function () {\n          return {\n            receiver: this.receiver\n          };\n        }\n      });\n    }\n  },\n  shimCreateOfferLegacy: function (window) {\n    var origCreateOffer = window.RTCPeerConnection.prototype.createOffer;\n\n    window.RTCPeerConnection.prototype.createOffer = function (offerOptions) {\n      var pc = this;\n\n      if (offerOptions) {\n        if (typeof offerOptions.offerToReceiveAudio !== 'undefined') {\n          // support bit values\n          offerOptions.offerToReceiveAudio = !!offerOptions.offerToReceiveAudio;\n        }\n\n        var audioTransceiver = pc.getTransceivers().find(function (transceiver) {\n          return transceiver.sender.track && transceiver.sender.track.kind === 'audio';\n        });\n\n        if (offerOptions.offerToReceiveAudio === false && audioTransceiver) {\n          if (audioTransceiver.direction === 'sendrecv') {\n            if (audioTransceiver.setDirection) {\n              audioTransceiver.setDirection('sendonly');\n            } else {\n              audioTransceiver.direction = 'sendonly';\n            }\n          } else if (audioTransceiver.direction === 'recvonly') {\n            if (audioTransceiver.setDirection) {\n              audioTransceiver.setDirection('inactive');\n            } else {\n              audioTransceiver.direction = 'inactive';\n            }\n          }\n        } else if (offerOptions.offerToReceiveAudio === true && !audioTransceiver) {\n          pc.addTransceiver('audio');\n        }\n\n        if (typeof offerOptions.offerToReceiveVideo !== 'undefined') {\n          // support bit values\n          offerOptions.offerToReceiveVideo = !!offerOptions.offerToReceiveVideo;\n        }\n\n        var videoTransceiver = pc.getTransceivers().find(function (transceiver) {\n          return transceiver.sender.track && transceiver.sender.track.kind === 'video';\n        });\n\n        if (offerOptions.offerToReceiveVideo === false && videoTransceiver) {\n          if (videoTransceiver.direction === 'sendrecv') {\n            videoTransceiver.setDirection('sendonly');\n          } else if (videoTransceiver.direction === 'recvonly') {\n            videoTransceiver.setDirection('inactive');\n          }\n        } else if (offerOptions.offerToReceiveVideo === true && !videoTransceiver) {\n          pc.addTransceiver('video');\n        }\n      }\n\n      return origCreateOffer.apply(pc, arguments);\n    };\n  }\n};","map":{"version":3,"sources":["/home/ryan/dev/defi/shadowtoken2/node_modules/@myetherwallet/mewconnect-web-client/node_modules/webrtc-adapter/src/js/safari/safari_shim.js"],"names":["utils","require","module","exports","shimLocalStreamsAPI","window","RTCPeerConnection","prototype","getLocalStreams","_localStreams","getStreamById","id","result","forEach","stream","_remoteStreams","_addTrack","addTrack","addStream","indexOf","push","pc","getTracks","track","call","removeStream","index","splice","tracks","getSenders","sender","removeTrack","shimRemoteStreamsAPI","getRemoteStreams","Object","defineProperty","get","_onaddstream","set","f","removeEventListener","addEventListener","origSetRemoteDescription","setRemoteDescription","_onaddstreampoly","e","streams","event","Event","dispatchEvent","apply","arguments","shimCallbacksAPI","createOffer","createAnswer","setLocalDescription","addIceCandidate","successCallback","failureCallback","options","length","promise","then","Promise","resolve","withCallback","description","candidate","shimGetUserMedia","navigator","getUserMedia","webkitGetUserMedia","bind","mediaDevices","constraints","cb","errcb","shimRTCIceServerUrls","OrigPeerConnection","pcConfig","pcConstraints","iceServers","newIceServers","i","server","hasOwnProperty","deprecated","JSON","parse","stringify","urls","url","generateCertificate","shimTrackEventTransceiver","RTCTrackEvent","RTCTransceiver","receiver","shimCreateOfferLegacy","origCreateOffer","offerOptions","offerToReceiveAudio","audioTransceiver","getTransceivers","find","transceiver","kind","direction","setDirection","addTransceiver","offerToReceiveVideo","videoTransceiver"],"mappings":"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","sourcesContent":["/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n'use strict';\nvar utils = require('../utils');\n\nmodule.exports = {\n  shimLocalStreamsAPI: function(window) {\n    if (typeof window !== 'object' || !window.RTCPeerConnection) {\n      return;\n    }\n    if (!('getLocalStreams' in window.RTCPeerConnection.prototype)) {\n      window.RTCPeerConnection.prototype.getLocalStreams = function() {\n        if (!this._localStreams) {\n          this._localStreams = [];\n        }\n        return this._localStreams;\n      };\n    }\n    if (!('getStreamById' in window.RTCPeerConnection.prototype)) {\n      window.RTCPeerConnection.prototype.getStreamById = function(id) {\n        var result = null;\n        if (this._localStreams) {\n          this._localStreams.forEach(function(stream) {\n            if (stream.id === id) {\n              result = stream;\n            }\n          });\n        }\n        if (this._remoteStreams) {\n          this._remoteStreams.forEach(function(stream) {\n            if (stream.id === id) {\n              result = stream;\n            }\n          });\n        }\n        return result;\n      };\n    }\n    if (!('addStream' in window.RTCPeerConnection.prototype)) {\n      var _addTrack = window.RTCPeerConnection.prototype.addTrack;\n      window.RTCPeerConnection.prototype.addStream = function(stream) {\n        if (!this._localStreams) {\n          this._localStreams = [];\n        }\n        if (this._localStreams.indexOf(stream) === -1) {\n          this._localStreams.push(stream);\n        }\n        var pc = this;\n        stream.getTracks().forEach(function(track) {\n          _addTrack.call(pc, track, stream);\n        });\n      };\n\n      window.RTCPeerConnection.prototype.addTrack = function(track, stream) {\n        if (stream) {\n          if (!this._localStreams) {\n            this._localStreams = [stream];\n          } else if (this._localStreams.indexOf(stream) === -1) {\n            this._localStreams.push(stream);\n          }\n        }\n        return _addTrack.call(this, track, stream);\n      };\n    }\n    if (!('removeStream' in window.RTCPeerConnection.prototype)) {\n      window.RTCPeerConnection.prototype.removeStream = function(stream) {\n        if (!this._localStreams) {\n          this._localStreams = [];\n        }\n        var index = this._localStreams.indexOf(stream);\n        if (index === -1) {\n          return;\n        }\n        this._localStreams.splice(index, 1);\n        var pc = this;\n        var tracks = stream.getTracks();\n        this.getSenders().forEach(function(sender) {\n          if (tracks.indexOf(sender.track) !== -1) {\n            pc.removeTrack(sender);\n          }\n        });\n      };\n    }\n  },\n  shimRemoteStreamsAPI: function(window) {\n    if (typeof window !== 'object' || !window.RTCPeerConnection) {\n      return;\n    }\n    if (!('getRemoteStreams' in window.RTCPeerConnection.prototype)) {\n      window.RTCPeerConnection.prototype.getRemoteStreams = function() {\n        return this._remoteStreams ? this._remoteStreams : [];\n      };\n    }\n    if (!('onaddstream' in window.RTCPeerConnection.prototype)) {\n      Object.defineProperty(window.RTCPeerConnection.prototype, 'onaddstream', {\n        get: function() {\n          return this._onaddstream;\n        },\n        set: function(f) {\n          if (this._onaddstream) {\n            this.removeEventListener('addstream', this._onaddstream);\n          }\n          this.addEventListener('addstream', this._onaddstream = f);\n        }\n      });\n      var origSetRemoteDescription =\n          window.RTCPeerConnection.prototype.setRemoteDescription;\n      window.RTCPeerConnection.prototype.setRemoteDescription = function() {\n        var pc = this;\n        if (!this._onaddstreampoly) {\n          this.addEventListener('track', this._onaddstreampoly = function(e) {\n            e.streams.forEach(function(stream) {\n              if (!pc._remoteStreams) {\n                pc._remoteStreams = [];\n              }\n              if (pc._remoteStreams.indexOf(stream) >= 0) {\n                return;\n              }\n              pc._remoteStreams.push(stream);\n              var event = new Event('addstream');\n              event.stream = stream;\n              pc.dispatchEvent(event);\n            });\n          });\n        }\n        return origSetRemoteDescription.apply(pc, arguments);\n      };\n    }\n  },\n  shimCallbacksAPI: function(window) {\n    if (typeof window !== 'object' || !window.RTCPeerConnection) {\n      return;\n    }\n    var prototype = window.RTCPeerConnection.prototype;\n    var createOffer = prototype.createOffer;\n    var createAnswer = prototype.createAnswer;\n    var setLocalDescription = prototype.setLocalDescription;\n    var setRemoteDescription = prototype.setRemoteDescription;\n    var addIceCandidate = prototype.addIceCandidate;\n\n    prototype.createOffer = function(successCallback, failureCallback) {\n      var options = (arguments.length >= 2) ? arguments[2] : arguments[0];\n      var promise = createOffer.apply(this, [options]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n\n    prototype.createAnswer = function(successCallback, failureCallback) {\n      var options = (arguments.length >= 2) ? arguments[2] : arguments[0];\n      var promise = createAnswer.apply(this, [options]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n\n    var withCallback = function(description, successCallback, failureCallback) {\n      var promise = setLocalDescription.apply(this, [description]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n    prototype.setLocalDescription = withCallback;\n\n    withCallback = function(description, successCallback, failureCallback) {\n      var promise = setRemoteDescription.apply(this, [description]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n    prototype.setRemoteDescription = withCallback;\n\n    withCallback = function(candidate, successCallback, failureCallback) {\n      var promise = addIceCandidate.apply(this, [candidate]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n    prototype.addIceCandidate = withCallback;\n  },\n  shimGetUserMedia: function(window) {\n    var navigator = window && window.navigator;\n\n    if (!navigator.getUserMedia) {\n      if (navigator.webkitGetUserMedia) {\n        navigator.getUserMedia = navigator.webkitGetUserMedia.bind(navigator);\n      } else if (navigator.mediaDevices &&\n          navigator.mediaDevices.getUserMedia) {\n        navigator.getUserMedia = function(constraints, cb, errcb) {\n          navigator.mediaDevices.getUserMedia(constraints)\n          .then(cb, errcb);\n        }.bind(navigator);\n      }\n    }\n  },\n  shimRTCIceServerUrls: function(window) {\n    // migrate from non-spec RTCIceServer.url to RTCIceServer.urls\n    var OrigPeerConnection = window.RTCPeerConnection;\n    window.RTCPeerConnection = function(pcConfig, pcConstraints) {\n      if (pcConfig && pcConfig.iceServers) {\n        var newIceServers = [];\n        for (var i = 0; i < pcConfig.iceServers.length; i++) {\n          var server = pcConfig.iceServers[i];\n          if (!server.hasOwnProperty('urls') &&\n              server.hasOwnProperty('url')) {\n            utils.deprecated('RTCIceServer.url', 'RTCIceServer.urls');\n            server = JSON.parse(JSON.stringify(server));\n            server.urls = server.url;\n            delete server.url;\n            newIceServers.push(server);\n          } else {\n            newIceServers.push(pcConfig.iceServers[i]);\n          }\n        }\n        pcConfig.iceServers = newIceServers;\n      }\n      return new OrigPeerConnection(pcConfig, pcConstraints);\n    };\n    window.RTCPeerConnection.prototype = OrigPeerConnection.prototype;\n    // wrap static methods. Currently just generateCertificate.\n    if ('generateCertificate' in window.RTCPeerConnection) {\n      Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\n        get: function() {\n          return OrigPeerConnection.generateCertificate;\n        }\n      });\n    }\n  },\n  shimTrackEventTransceiver: function(window) {\n    // Add event.transceiver member over deprecated event.receiver\n    if (typeof window === 'object' && window.RTCPeerConnection &&\n        ('receiver' in window.RTCTrackEvent.prototype) &&\n        // can't check 'transceiver' in window.RTCTrackEvent.prototype, as it is\n        // defined for some reason even when window.RTCTransceiver is not.\n        !window.RTCTransceiver) {\n      Object.defineProperty(window.RTCTrackEvent.prototype, 'transceiver', {\n        get: function() {\n          return {receiver: this.receiver};\n        }\n      });\n    }\n  },\n\n  shimCreateOfferLegacy: function(window) {\n    var origCreateOffer = window.RTCPeerConnection.prototype.createOffer;\n    window.RTCPeerConnection.prototype.createOffer = function(offerOptions) {\n      var pc = this;\n      if (offerOptions) {\n        if (typeof offerOptions.offerToReceiveAudio !== 'undefined') {\n          // support bit values\n          offerOptions.offerToReceiveAudio = !!offerOptions.offerToReceiveAudio;\n        }\n        var audioTransceiver = pc.getTransceivers().find(function(transceiver) {\n          return transceiver.sender.track &&\n              transceiver.sender.track.kind === 'audio';\n        });\n        if (offerOptions.offerToReceiveAudio === false && audioTransceiver) {\n          if (audioTransceiver.direction === 'sendrecv') {\n            if (audioTransceiver.setDirection) {\n              audioTransceiver.setDirection('sendonly');\n            } else {\n              audioTransceiver.direction = 'sendonly';\n            }\n          } else if (audioTransceiver.direction === 'recvonly') {\n            if (audioTransceiver.setDirection) {\n              audioTransceiver.setDirection('inactive');\n            } else {\n              audioTransceiver.direction = 'inactive';\n            }\n          }\n        } else if (offerOptions.offerToReceiveAudio === true &&\n            !audioTransceiver) {\n          pc.addTransceiver('audio');\n        }\n\n\n        if (typeof offerOptions.offerToReceiveVideo !== 'undefined') {\n          // support bit values\n          offerOptions.offerToReceiveVideo = !!offerOptions.offerToReceiveVideo;\n        }\n        var videoTransceiver = pc.getTransceivers().find(function(transceiver) {\n          return transceiver.sender.track &&\n              transceiver.sender.track.kind === 'video';\n        });\n        if (offerOptions.offerToReceiveVideo === false && videoTransceiver) {\n          if (videoTransceiver.direction === 'sendrecv') {\n            videoTransceiver.setDirection('sendonly');\n          } else if (videoTransceiver.direction === 'recvonly') {\n            videoTransceiver.setDirection('inactive');\n          }\n        } else if (offerOptions.offerToReceiveVideo === true &&\n            !videoTransceiver) {\n          pc.addTransceiver('video');\n        }\n      }\n      return origCreateOffer.apply(pc, arguments);\n    };\n  }\n};\n"]},"metadata":{},"sourceType":"script"}