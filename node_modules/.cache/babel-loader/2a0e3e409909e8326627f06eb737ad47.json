{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _ws = require('ws');\n\nvar _ws2 = _interopRequireDefault(_ws);\n\nvar _pify = require('pify');\n\nvar _pify2 = _interopRequireDefault(_pify);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _asyncToGenerator(fn) {\n  return function () {\n    var gen = fn.apply(this, arguments);\n    return new Promise(function (resolve, reject) {\n      function step(key, arg) {\n        try {\n          var info = gen[key](arg);\n          var value = info.value;\n        } catch (error) {\n          reject(error);\n          return;\n        }\n\n        if (info.done) {\n          resolve(value);\n        } else {\n          return Promise.resolve(value).then(function (value) {\n            step(\"next\", value);\n          }, function (err) {\n            step(\"throw\", err);\n          });\n        }\n      }\n\n      return step(\"next\");\n    });\n  };\n}\n\nfunction extendWS(ws) {\n  if (ws._promised) return ws;\n\n  function promisify(method) {\n    const callbackMethod = `${method}Callback`;\n    ws[callbackMethod] = ws[method];\n    ws[method] = (0, _pify2.default)(ws[callbackMethod]);\n  }\n\n  ws._promised = true;\n  promisify('send');\n  promisify('ping');\n  promisify('pong');\n  return ws;\n}\n\nclass PromiseWebSocketServer extends _ws2.default.Server {\n  static create(options) {\n    return _asyncToGenerator(function* () {\n      return new Promise(function (resolve, reject) {\n        const wss = new PromiseWebSocketServer(options);\n        const server = options.server,\n              noServer = options.noServer;\n\n        const done = function () {\n          return resolve(wss);\n        };\n\n        if (noServer || server && server.listening) process.nextTick(done);else wss.once('listening', done);\n        wss.once('error', reject);\n      });\n    })();\n  }\n\n  on(event, listener) {\n    if (event === 'connection') {\n      return super.on(event, ws => listener(extendWS(ws)));\n    }\n\n    return super.on(event, listener);\n  }\n\n  close() {\n    return (0, _pify2.default)(super.close.bind(this))();\n  }\n\n}\n\nclass PromiseWebSocket extends _ws2.default {\n  static create() {\n    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    return new Promise((resolve, reject) => {\n      const ws = new (Function.prototype.bind.apply(PromiseWebSocket, [null].concat(args)))();\n      ws.once('open', () => resolve(ws));\n      ws.once('error', reject);\n    });\n  }\n\n  constructor() {\n    super(...arguments);\n    extendWS(this);\n  }\n\n}\n\nexports.default = PromiseWebSocket;\nPromiseWebSocket.Server = PromiseWebSocketServer;\nPromiseWebSocket.WebSocket = _ws2.default;","map":{"version":3,"sources":["/home/ryan/dev/defi/shadowtoken2/node_modules/@myetherwallet/mewconnect-web-client/node_modules/promise-ws/lib/index.js"],"names":["Object","defineProperty","exports","value","_ws","require","_ws2","_interopRequireDefault","_pify","_pify2","obj","__esModule","default","_asyncToGenerator","fn","gen","apply","arguments","Promise","resolve","reject","step","key","arg","info","error","done","then","err","extendWS","ws","_promised","promisify","method","callbackMethod","PromiseWebSocketServer","Server","create","options","wss","server","noServer","listening","process","nextTick","once","on","event","listener","close","bind","PromiseWebSocket","_len","length","args","Array","_key","Function","prototype","concat","constructor","WebSocket"],"mappings":"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","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _ws = require('ws');\n\nvar _ws2 = _interopRequireDefault(_ws);\n\nvar _pify = require('pify');\n\nvar _pify2 = _interopRequireDefault(_pify);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _asyncToGenerator(fn) { return function () { var gen = fn.apply(this, arguments); return new Promise(function (resolve, reject) { function step(key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { return Promise.resolve(value).then(function (value) { step(\"next\", value); }, function (err) { step(\"throw\", err); }); } } return step(\"next\"); }); }; }\n\nfunction extendWS(ws) {\n\tif (ws._promised) return ws;\n\n\tfunction promisify(method) {\n\t\tconst callbackMethod = `${ method }Callback`;\n\t\tws[callbackMethod] = ws[method];\n\t\tws[method] = (0, _pify2.default)(ws[callbackMethod]);\n\t}\n\n\tws._promised = true;\n\tpromisify('send');\n\tpromisify('ping');\n\tpromisify('pong');\n\treturn ws;\n}\n\nclass PromiseWebSocketServer extends _ws2.default.Server {\n\tstatic create(options) {\n\t\treturn _asyncToGenerator(function* () {\n\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\tconst wss = new PromiseWebSocketServer(options);\n\t\t\t\tconst server = options.server,\n\t\t\t\t      noServer = options.noServer;\n\n\t\t\t\tconst done = function () {\n\t\t\t\t\treturn resolve(wss);\n\t\t\t\t};\n\t\t\t\tif (noServer || server && server.listening) process.nextTick(done);else wss.once('listening', done);\n\t\t\t\twss.once('error', reject);\n\t\t\t});\n\t\t})();\n\t}\n\n\ton(event, listener) {\n\t\tif (event === 'connection') {\n\t\t\treturn super.on(event, ws => listener(extendWS(ws)));\n\t\t}\n\t\treturn super.on(event, listener);\n\t}\n\n\tclose() {\n\t\treturn (0, _pify2.default)(super.close.bind(this))();\n\t}\n}\n\nclass PromiseWebSocket extends _ws2.default {\n\n\tstatic create() {\n\t\tfor (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n\t\t\targs[_key] = arguments[_key];\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst ws = new (Function.prototype.bind.apply(PromiseWebSocket, [null].concat(args)))();\n\t\t\tws.once('open', () => resolve(ws));\n\t\t\tws.once('error', reject);\n\t\t});\n\t}\n\n\tconstructor() {\n\t\tsuper(...arguments);\n\t\textendWS(this);\n\t}\n}\nexports.default = PromiseWebSocket;\nPromiseWebSocket.Server = PromiseWebSocketServer;\nPromiseWebSocket.WebSocket = _ws2.default;"]},"metadata":{},"sourceType":"script"}