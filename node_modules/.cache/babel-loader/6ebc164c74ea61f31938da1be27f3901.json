{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.BitcoinDotCom = exports.broadcastTransaction = void 0;\n\nconst axios_1 = __importDefault(require(\"axios\"));\n\nconst utxo_1 = require(\"../../lib/utxo\");\n\nconst timeout_1 = require(\"./timeout\");\n\nconst endpoint = testnet => testnet ? \"https://trest.bitcoin.com/v2/\" : \"https://rest.bitcoin.com/v2/\";\n\nconst fetchUTXO = testnet => async (txHash, vOut) => {\n  const url = `${endpoint(testnet).replace(/\\/$/, \"\")}/transaction/details/${txHash}`;\n  const response = await axios_1.default.get(`${url}`, {\n    timeout: timeout_1.DEFAULT_TIMEOUT\n  });\n  const utxo = response.data;\n  return utxo_1.fixUTXO({\n    txHash,\n    amount: parseFloat(utxo.vout[vOut].value),\n    // script_hex: utxo.scriptPubKey,\n    vOut,\n    confirmations: utxo.confirmations\n  }, 8);\n};\n\nconst fetchConfirmations = testnet => async txHash => {\n  const url = `${endpoint(testnet).replace(/\\/$/, \"\")}/transaction/details/${txHash}`;\n  const tx = (await axios_1.default.get(`${url}`, {\n    timeout: timeout_1.DEFAULT_TIMEOUT\n  })).data;\n  return tx.confirmations;\n};\n\nconst fetchUTXOs = testnet => async (address, confirmations) => {\n  const url = `${endpoint(testnet).replace(/\\/$/, \"\")}/address/utxo/${address}`;\n  const response = await axios_1.default.get(url, {\n    timeout: timeout_1.DEFAULT_TIMEOUT\n  });\n  return utxo_1.fixUTXOs(response.data.utxos.map(utxo => ({\n    txHash: utxo.txid,\n    amount: utxo.amount,\n    // script_hex: utxo.scriptPubKey,\n    vOut: utxo.vout,\n    confirmations: utxo.confirmations\n  })).filter(utxo => confirmations === 0 || utxo.confirmations >= confirmations), 8).sort(utxo_1.sortUTXOs);\n};\n\nexports.broadcastTransaction = testnet => async txHex => {\n  const url = `${endpoint(testnet).replace(/\\/$/, \"\")}/rawtransactions/sendRawTransaction`;\n  const response = await axios_1.default.post(url, {\n    \"hexes\": [txHex]\n  }, {\n    timeout: timeout_1.DEFAULT_TIMEOUT\n  });\n\n  if (response.data.error) {\n    throw new Error(response.data.error);\n  }\n\n  return response.data[0];\n};\n\nexports.BitcoinDotCom = {\n  fetchUTXO,\n  fetchUTXOs,\n  fetchConfirmations,\n  broadcastTransaction: exports.broadcastTransaction\n};","map":{"version":3,"sources":["../../../../src/common/apis/bitcoinDotCom.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.BitcoinDotCom = exports.broadcastTransaction = void 0;\nconst axios_1 = __importDefault(require(\"axios\"));\nconst utxo_1 = require(\"../../lib/utxo\");\nconst timeout_1 = require(\"./timeout\");\nconst endpoint = (testnet) => testnet ? \"https://trest.bitcoin.com/v2/\" : \"https://rest.bitcoin.com/v2/\";\nconst fetchUTXO = (testnet) => async (txHash, vOut) => {\n    const url = `${endpoint(testnet).replace(/\\/$/, \"\")}/transaction/details/${txHash}`;\n    const response = await axios_1.default.get(`${url}`, { timeout: timeout_1.DEFAULT_TIMEOUT });\n    const utxo = response.data;\n    return utxo_1.fixUTXO({\n        txHash,\n        amount: parseFloat(utxo.vout[vOut].value),\n        // script_hex: utxo.scriptPubKey,\n        vOut,\n        confirmations: utxo.confirmations,\n    }, 8);\n};\nconst fetchConfirmations = (testnet) => async (txHash) => {\n    const url = `${endpoint(testnet).replace(/\\/$/, \"\")}/transaction/details/${txHash}`;\n    const tx = (await axios_1.default.get(`${url}`, { timeout: timeout_1.DEFAULT_TIMEOUT })).data;\n    return tx.confirmations;\n};\nconst fetchUTXOs = (testnet) => async (address, confirmations) => {\n    const url = `${endpoint(testnet).replace(/\\/$/, \"\")}/address/utxo/${address}`;\n    const response = await axios_1.default.get(url, { timeout: timeout_1.DEFAULT_TIMEOUT });\n    return utxo_1.fixUTXOs(response.data.utxos.map(utxo => ({\n        txHash: utxo.txid,\n        amount: utxo.amount,\n        // script_hex: utxo.scriptPubKey,\n        vOut: utxo.vout,\n        confirmations: utxo.confirmations,\n    }))\n        .filter(utxo => confirmations === 0 || utxo.confirmations >= confirmations), 8)\n        .sort(utxo_1.sortUTXOs);\n};\nexports.broadcastTransaction = (testnet) => async (txHex) => {\n    const url = `${endpoint(testnet).replace(/\\/$/, \"\")}/rawtransactions/sendRawTransaction`;\n    const response = await axios_1.default.post(url, { \"hexes\": [txHex] }, { timeout: timeout_1.DEFAULT_TIMEOUT });\n    if (response.data.error) {\n        throw new Error(response.data.error);\n    }\n    return response.data[0];\n};\nexports.BitcoinDotCom = {\n    fetchUTXO,\n    fetchUTXOs,\n    fetchConfirmations,\n    broadcastTransaction: exports.broadcastTransaction,\n};\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYml0Y29pbkRvdENvbS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21tb24vYXBpcy9iaXRjb2luRG90Q29tLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLGtEQUEwQjtBQUUxQix5Q0FBOEU7QUFDOUUsdUNBQTRDO0FBcUQ1QyxNQUFNLFFBQVEsR0FBRyxDQUFDLE9BQWdCLEVBQUUsRUFBRSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsK0JBQStCLENBQUMsQ0FBQyxDQUFDLDhCQUE4QixDQUFDO0FBRWxILE1BQU0sU0FBUyxHQUFHLENBQUMsT0FBZ0IsRUFBRSxFQUFFLENBQUMsS0FBSyxFQUFFLE1BQWMsRUFBRSxJQUFZLEVBQWlCLEVBQUU7SUFDMUYsTUFBTSxHQUFHLEdBQUcsR0FBRyxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsd0JBQXdCLE1BQU0sRUFBRSxDQUFDO0lBRXBGLE1BQU0sUUFBUSxHQUFHLE1BQU0sZUFBSyxDQUFDLEdBQUcsQ0FBbUIsR0FBRyxHQUFHLEVBQUUsRUFBRSxFQUFFLE9BQU8sRUFBRSx5QkFBZSxFQUFFLENBQUMsQ0FBQztJQUUzRixNQUFNLElBQUksR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDO0lBRTNCLE9BQU8sY0FBTyxDQUFDO1FBQ1gsTUFBTTtRQUNOLE1BQU0sRUFBRSxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxLQUFLLENBQUM7UUFDekMsaUNBQWlDO1FBQ2pDLElBQUk7UUFDSixhQUFhLEVBQUUsSUFBSSxDQUFDLGFBQWE7S0FDcEMsRUFBRSxDQUFDLENBQUMsQ0FBQztBQUNWLENBQUMsQ0FBQztBQUVGLE1BQU0sa0JBQWtCLEdBQUcsQ0FBQyxPQUFnQixFQUFFLEVBQUUsQ0FBQyxLQUFLLEVBQUUsTUFBYyxFQUFtQixFQUFFO0lBQ3ZGLE1BQU0sR0FBRyxHQUFHLEdBQUcsUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLHdCQUF3QixNQUFNLEVBQUUsQ0FBQztJQUVwRixNQUFNLEVBQUUsR0FBRyxDQUFDLE1BQU0sZUFBSyxDQUFDLEdBQUcsQ0FjeEIsR0FBRyxHQUFHLEVBQUUsRUFBRSxFQUFFLE9BQU8sRUFBRSx5QkFBZSxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztJQUVqRCxPQUFPLEVBQUUsQ0FBQyxhQUFhLENBQUM7QUFDNUIsQ0FBQyxDQUFDO0FBRUYsTUFBTSxVQUFVLEdBQUcsQ0FBQyxPQUFnQixFQUFFLEVBQUUsQ0FBQyxLQUFLLEVBQUUsT0FBZSxFQUFFLGFBQXFCLEVBQTRCLEVBQUU7SUFDaEgsTUFBTSxHQUFHLEdBQUcsR0FBRyxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsaUJBQWlCLE9BQU8sRUFBRSxDQUFDO0lBQzlFLE1BQU0sUUFBUSxHQUFHLE1BQU0sZUFBSyxDQUFDLEdBQUcsQ0FXN0IsR0FBRyxFQUFFLEVBQUUsT0FBTyxFQUFFLHlCQUFlLEVBQUUsQ0FBQyxDQUFDO0lBQ3RDLE9BQU8sZUFBUSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDN0MsTUFBTSxFQUFFLElBQUksQ0FBQyxJQUFJO1FBQ2pCLE1BQU0sRUFBRSxJQUFJLENBQUMsTUFBTTtRQUNuQixpQ0FBaUM7UUFDakMsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJO1FBQ2YsYUFBYSxFQUFFLElBQUksQ0FBQyxhQUFhO0tBQ3BDLENBQUMsQ0FBQztTQUNFLE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLGFBQWEsS0FBSyxDQUFDLElBQUksSUFBSSxDQUFDLGFBQWEsSUFBSSxhQUFhLENBQUMsRUFBRSxDQUFDLENBQUM7U0FDOUUsSUFBSSxDQUFDLGdCQUFTLENBQUMsQ0FBQztBQUN6QixDQUFDLENBQUM7QUFFVyxRQUFBLG9CQUFvQixHQUFHLENBQUMsT0FBZ0IsRUFBRSxFQUFFLENBQUMsS0FBSyxFQUFFLEtBQWEsRUFBbUIsRUFBRTtJQUMvRixNQUFNLEdBQUcsR0FBRyxHQUFHLFFBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxxQ0FBcUMsQ0FBQztJQUN6RixNQUFNLFFBQVEsR0FBRyxNQUFNLGVBQUssQ0FBQyxJQUFJLENBQzdCLEdBQUcsRUFDSCxFQUFFLE9BQU8sRUFBRSxDQUFDLEtBQUssQ0FBQyxFQUFFLEVBQ3BCLEVBQUUsT0FBTyxFQUFFLHlCQUFlLEVBQUUsQ0FDL0IsQ0FBQztJQUNGLElBQUssUUFBUSxDQUFDLElBQVksQ0FBQyxLQUFLLEVBQUU7UUFDOUIsTUFBTSxJQUFJLEtBQUssQ0FBRSxRQUFRLENBQUMsSUFBWSxDQUFDLEtBQUssQ0FBQyxDQUFDO0tBQ2pEO0lBQ0QsT0FBTyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQzVCLENBQUMsQ0FBQztBQUVXLFFBQUEsYUFBYSxHQUFHO0lBQ3pCLFNBQVM7SUFDVCxVQUFVO0lBQ1Ysa0JBQWtCO0lBQ2xCLG9CQUFvQixFQUFwQiw0QkFBb0I7Q0FDdkIsQ0FBQyJ9"]},"metadata":{},"sourceType":"script"}