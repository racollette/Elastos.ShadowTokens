{"ast":null,"code":"/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n\n/* eslint-env node */\n'use strict';\n\nvar utils = require('../utils');\n\nvar logging = utils.log; // Expose public methods.\n\nmodule.exports = function (window) {\n  var browserDetails = utils.detectBrowser(window);\n  var navigator = window && window.navigator;\n  var MediaStreamTrack = window && window.MediaStreamTrack;\n\n  var shimError_ = function (e) {\n    return {\n      name: {\n        InternalError: 'NotReadableError',\n        NotSupportedError: 'TypeError',\n        PermissionDeniedError: 'NotAllowedError',\n        SecurityError: 'NotAllowedError'\n      }[e.name] || e.name,\n      message: {\n        'The operation is insecure.': 'The request is not allowed by the ' + 'user agent or the platform in the current context.'\n      }[e.message] || e.message,\n      constraint: e.constraint,\n      toString: function () {\n        return this.name + (this.message && ': ') + this.message;\n      }\n    };\n  }; // getUserMedia constraints shim.\n\n\n  var getUserMedia_ = function (constraints, onSuccess, onError) {\n    var constraintsToFF37_ = function (c) {\n      if (typeof c !== 'object' || c.require) {\n        return c;\n      }\n\n      var require = [];\n      Object.keys(c).forEach(function (key) {\n        if (key === 'require' || key === 'advanced' || key === 'mediaSource') {\n          return;\n        }\n\n        var r = c[key] = typeof c[key] === 'object' ? c[key] : {\n          ideal: c[key]\n        };\n\n        if (r.min !== undefined || r.max !== undefined || r.exact !== undefined) {\n          require.push(key);\n        }\n\n        if (r.exact !== undefined) {\n          if (typeof r.exact === 'number') {\n            r.min = r.max = r.exact;\n          } else {\n            c[key] = r.exact;\n          }\n\n          delete r.exact;\n        }\n\n        if (r.ideal !== undefined) {\n          c.advanced = c.advanced || [];\n          var oc = {};\n\n          if (typeof r.ideal === 'number') {\n            oc[key] = {\n              min: r.ideal,\n              max: r.ideal\n            };\n          } else {\n            oc[key] = r.ideal;\n          }\n\n          c.advanced.push(oc);\n          delete r.ideal;\n\n          if (!Object.keys(r).length) {\n            delete c[key];\n          }\n        }\n      });\n\n      if (require.length) {\n        c.require = require;\n      }\n\n      return c;\n    };\n\n    constraints = JSON.parse(JSON.stringify(constraints));\n\n    if (browserDetails.version < 38) {\n      logging('spec: ' + JSON.stringify(constraints));\n\n      if (constraints.audio) {\n        constraints.audio = constraintsToFF37_(constraints.audio);\n      }\n\n      if (constraints.video) {\n        constraints.video = constraintsToFF37_(constraints.video);\n      }\n\n      logging('ff37: ' + JSON.stringify(constraints));\n    }\n\n    return navigator.mozGetUserMedia(constraints, onSuccess, function (e) {\n      onError(shimError_(e));\n    });\n  }; // Returns the result of getUserMedia as a Promise.\n\n\n  var getUserMediaPromise_ = function (constraints) {\n    return new Promise(function (resolve, reject) {\n      getUserMedia_(constraints, resolve, reject);\n    });\n  }; // Shim for mediaDevices on older versions.\n\n\n  if (!navigator.mediaDevices) {\n    navigator.mediaDevices = {\n      getUserMedia: getUserMediaPromise_,\n      addEventListener: function () {},\n      removeEventListener: function () {}\n    };\n  }\n\n  navigator.mediaDevices.enumerateDevices = navigator.mediaDevices.enumerateDevices || function () {\n    return new Promise(function (resolve) {\n      var infos = [{\n        kind: 'audioinput',\n        deviceId: 'default',\n        label: '',\n        groupId: ''\n      }, {\n        kind: 'videoinput',\n        deviceId: 'default',\n        label: '',\n        groupId: ''\n      }];\n      resolve(infos);\n    });\n  };\n\n  if (browserDetails.version < 41) {\n    // Work around http://bugzil.la/1169665\n    var orgEnumerateDevices = navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);\n\n    navigator.mediaDevices.enumerateDevices = function () {\n      return orgEnumerateDevices().then(undefined, function (e) {\n        if (e.name === 'NotFoundError') {\n          return [];\n        }\n\n        throw e;\n      });\n    };\n  }\n\n  if (browserDetails.version < 49) {\n    var origGetUserMedia = navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);\n\n    navigator.mediaDevices.getUserMedia = function (c) {\n      return origGetUserMedia(c).then(function (stream) {\n        // Work around https://bugzil.la/802326\n        if (c.audio && !stream.getAudioTracks().length || c.video && !stream.getVideoTracks().length) {\n          stream.getTracks().forEach(function (track) {\n            track.stop();\n          });\n          throw new DOMException('The object can not be found here.', 'NotFoundError');\n        }\n\n        return stream;\n      }, function (e) {\n        return Promise.reject(shimError_(e));\n      });\n    };\n  }\n\n  if (!(browserDetails.version > 55 && 'autoGainControl' in navigator.mediaDevices.getSupportedConstraints())) {\n    var remap = function (obj, a, b) {\n      if (a in obj && !(b in obj)) {\n        obj[b] = obj[a];\n        delete obj[a];\n      }\n    };\n\n    var nativeGetUserMedia = navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);\n\n    navigator.mediaDevices.getUserMedia = function (c) {\n      if (typeof c === 'object' && typeof c.audio === 'object') {\n        c = JSON.parse(JSON.stringify(c));\n        remap(c.audio, 'autoGainControl', 'mozAutoGainControl');\n        remap(c.audio, 'noiseSuppression', 'mozNoiseSuppression');\n      }\n\n      return nativeGetUserMedia(c);\n    };\n\n    if (MediaStreamTrack && MediaStreamTrack.prototype.getSettings) {\n      var nativeGetSettings = MediaStreamTrack.prototype.getSettings;\n\n      MediaStreamTrack.prototype.getSettings = function () {\n        var obj = nativeGetSettings.apply(this, arguments);\n        remap(obj, 'mozAutoGainControl', 'autoGainControl');\n        remap(obj, 'mozNoiseSuppression', 'noiseSuppression');\n        return obj;\n      };\n    }\n\n    if (MediaStreamTrack && MediaStreamTrack.prototype.applyConstraints) {\n      var nativeApplyConstraints = MediaStreamTrack.prototype.applyConstraints;\n\n      MediaStreamTrack.prototype.applyConstraints = function (c) {\n        if (this.kind === 'audio' && typeof c === 'object') {\n          c = JSON.parse(JSON.stringify(c));\n          remap(c, 'autoGainControl', 'mozAutoGainControl');\n          remap(c, 'noiseSuppression', 'mozNoiseSuppression');\n        }\n\n        return nativeApplyConstraints.apply(this, [c]);\n      };\n    }\n  }\n\n  navigator.getUserMedia = function (constraints, onSuccess, onError) {\n    if (browserDetails.version < 44) {\n      return getUserMedia_(constraints, onSuccess, onError);\n    } // Replace Firefox 44+'s deprecation warning with unprefixed version.\n\n\n    utils.deprecated('navigator.getUserMedia', 'navigator.mediaDevices.getUserMedia');\n    navigator.mediaDevices.getUserMedia(constraints).then(onSuccess, onError);\n  };\n};","map":{"version":3,"sources":["/home/ryan/dev/defi/bridge/node_modules/@myetherwallet/mewconnect-web-client/node_modules/webrtc-adapter/src/js/firefox/getusermedia.js"],"names":["utils","require","logging","log","module","exports","window","browserDetails","detectBrowser","navigator","MediaStreamTrack","shimError_","e","name","InternalError","NotSupportedError","PermissionDeniedError","SecurityError","message","constraint","toString","getUserMedia_","constraints","onSuccess","onError","constraintsToFF37_","c","Object","keys","forEach","key","r","ideal","min","undefined","max","exact","push","advanced","oc","length","JSON","parse","stringify","version","audio","video","mozGetUserMedia","getUserMediaPromise_","Promise","resolve","reject","mediaDevices","getUserMedia","addEventListener","removeEventListener","enumerateDevices","infos","kind","deviceId","label","groupId","orgEnumerateDevices","bind","then","origGetUserMedia","stream","getAudioTracks","getVideoTracks","getTracks","track","stop","DOMException","getSupportedConstraints","remap","obj","a","b","nativeGetUserMedia","prototype","getSettings","nativeGetSettings","apply","arguments","applyConstraints","nativeApplyConstraints","deprecated"],"mappings":"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","sourcesContent":["/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar utils = require('../utils');\nvar logging = utils.log;\n\n// Expose public methods.\nmodule.exports = function(window) {\n  var browserDetails = utils.detectBrowser(window);\n  var navigator = window && window.navigator;\n  var MediaStreamTrack = window && window.MediaStreamTrack;\n\n  var shimError_ = function(e) {\n    return {\n      name: {\n        InternalError: 'NotReadableError',\n        NotSupportedError: 'TypeError',\n        PermissionDeniedError: 'NotAllowedError',\n        SecurityError: 'NotAllowedError'\n      }[e.name] || e.name,\n      message: {\n        'The operation is insecure.': 'The request is not allowed by the ' +\n        'user agent or the platform in the current context.'\n      }[e.message] || e.message,\n      constraint: e.constraint,\n      toString: function() {\n        return this.name + (this.message && ': ') + this.message;\n      }\n    };\n  };\n\n  // getUserMedia constraints shim.\n  var getUserMedia_ = function(constraints, onSuccess, onError) {\n    var constraintsToFF37_ = function(c) {\n      if (typeof c !== 'object' || c.require) {\n        return c;\n      }\n      var require = [];\n      Object.keys(c).forEach(function(key) {\n        if (key === 'require' || key === 'advanced' || key === 'mediaSource') {\n          return;\n        }\n        var r = c[key] = (typeof c[key] === 'object') ?\n            c[key] : {ideal: c[key]};\n        if (r.min !== undefined ||\n            r.max !== undefined || r.exact !== undefined) {\n          require.push(key);\n        }\n        if (r.exact !== undefined) {\n          if (typeof r.exact === 'number') {\n            r. min = r.max = r.exact;\n          } else {\n            c[key] = r.exact;\n          }\n          delete r.exact;\n        }\n        if (r.ideal !== undefined) {\n          c.advanced = c.advanced || [];\n          var oc = {};\n          if (typeof r.ideal === 'number') {\n            oc[key] = {min: r.ideal, max: r.ideal};\n          } else {\n            oc[key] = r.ideal;\n          }\n          c.advanced.push(oc);\n          delete r.ideal;\n          if (!Object.keys(r).length) {\n            delete c[key];\n          }\n        }\n      });\n      if (require.length) {\n        c.require = require;\n      }\n      return c;\n    };\n    constraints = JSON.parse(JSON.stringify(constraints));\n    if (browserDetails.version < 38) {\n      logging('spec: ' + JSON.stringify(constraints));\n      if (constraints.audio) {\n        constraints.audio = constraintsToFF37_(constraints.audio);\n      }\n      if (constraints.video) {\n        constraints.video = constraintsToFF37_(constraints.video);\n      }\n      logging('ff37: ' + JSON.stringify(constraints));\n    }\n    return navigator.mozGetUserMedia(constraints, onSuccess, function(e) {\n      onError(shimError_(e));\n    });\n  };\n\n  // Returns the result of getUserMedia as a Promise.\n  var getUserMediaPromise_ = function(constraints) {\n    return new Promise(function(resolve, reject) {\n      getUserMedia_(constraints, resolve, reject);\n    });\n  };\n\n  // Shim for mediaDevices on older versions.\n  if (!navigator.mediaDevices) {\n    navigator.mediaDevices = {getUserMedia: getUserMediaPromise_,\n      addEventListener: function() { },\n      removeEventListener: function() { }\n    };\n  }\n  navigator.mediaDevices.enumerateDevices =\n      navigator.mediaDevices.enumerateDevices || function() {\n        return new Promise(function(resolve) {\n          var infos = [\n            {kind: 'audioinput', deviceId: 'default', label: '', groupId: ''},\n            {kind: 'videoinput', deviceId: 'default', label: '', groupId: ''}\n          ];\n          resolve(infos);\n        });\n      };\n\n  if (browserDetails.version < 41) {\n    // Work around http://bugzil.la/1169665\n    var orgEnumerateDevices =\n        navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);\n    navigator.mediaDevices.enumerateDevices = function() {\n      return orgEnumerateDevices().then(undefined, function(e) {\n        if (e.name === 'NotFoundError') {\n          return [];\n        }\n        throw e;\n      });\n    };\n  }\n  if (browserDetails.version < 49) {\n    var origGetUserMedia = navigator.mediaDevices.getUserMedia.\n        bind(navigator.mediaDevices);\n    navigator.mediaDevices.getUserMedia = function(c) {\n      return origGetUserMedia(c).then(function(stream) {\n        // Work around https://bugzil.la/802326\n        if (c.audio && !stream.getAudioTracks().length ||\n            c.video && !stream.getVideoTracks().length) {\n          stream.getTracks().forEach(function(track) {\n            track.stop();\n          });\n          throw new DOMException('The object can not be found here.',\n                                 'NotFoundError');\n        }\n        return stream;\n      }, function(e) {\n        return Promise.reject(shimError_(e));\n      });\n    };\n  }\n  if (!(browserDetails.version > 55 &&\n      'autoGainControl' in navigator.mediaDevices.getSupportedConstraints())) {\n    var remap = function(obj, a, b) {\n      if (a in obj && !(b in obj)) {\n        obj[b] = obj[a];\n        delete obj[a];\n      }\n    };\n\n    var nativeGetUserMedia = navigator.mediaDevices.getUserMedia.\n        bind(navigator.mediaDevices);\n    navigator.mediaDevices.getUserMedia = function(c) {\n      if (typeof c === 'object' && typeof c.audio === 'object') {\n        c = JSON.parse(JSON.stringify(c));\n        remap(c.audio, 'autoGainControl', 'mozAutoGainControl');\n        remap(c.audio, 'noiseSuppression', 'mozNoiseSuppression');\n      }\n      return nativeGetUserMedia(c);\n    };\n\n    if (MediaStreamTrack && MediaStreamTrack.prototype.getSettings) {\n      var nativeGetSettings = MediaStreamTrack.prototype.getSettings;\n      MediaStreamTrack.prototype.getSettings = function() {\n        var obj = nativeGetSettings.apply(this, arguments);\n        remap(obj, 'mozAutoGainControl', 'autoGainControl');\n        remap(obj, 'mozNoiseSuppression', 'noiseSuppression');\n        return obj;\n      };\n    }\n\n    if (MediaStreamTrack && MediaStreamTrack.prototype.applyConstraints) {\n      var nativeApplyConstraints = MediaStreamTrack.prototype.applyConstraints;\n      MediaStreamTrack.prototype.applyConstraints = function(c) {\n        if (this.kind === 'audio' && typeof c === 'object') {\n          c = JSON.parse(JSON.stringify(c));\n          remap(c, 'autoGainControl', 'mozAutoGainControl');\n          remap(c, 'noiseSuppression', 'mozNoiseSuppression');\n        }\n        return nativeApplyConstraints.apply(this, [c]);\n      };\n    }\n  }\n  navigator.getUserMedia = function(constraints, onSuccess, onError) {\n    if (browserDetails.version < 44) {\n      return getUserMedia_(constraints, onSuccess, onError);\n    }\n    // Replace Firefox 44+'s deprecation warning with unprefixed version.\n    utils.deprecated('navigator.getUserMedia',\n        'navigator.mediaDevices.getUserMedia');\n    navigator.mediaDevices.getUserMedia(constraints).then(onSuccess, onError);\n  };\n};\n"]},"metadata":{},"sourceType":"script"}