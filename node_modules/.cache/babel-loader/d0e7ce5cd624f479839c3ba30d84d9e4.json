{"ast":null,"code":"/* eslint-disable */\n'use strict';\n\nconst _ = require('underscore');\n\nconst errors = require('web3-core-helpers').errors;\n\nlet Ws = null;\nlet _btoa = null;\nlet parseURL = null;\n\nWs = function (url, protocols) {\n  if (protocols) return new window.WebSocket(url, protocols);\n  return new window.WebSocket(url);\n};\n\n_btoa = btoa;\n\nparseURL = function (url) {\n  return new URL(url);\n};\n\nconst WebsocketProvider = function WebsocketProvider(url, options) {\n  const _this = this;\n\n  this.responseCallbacks = {};\n  this.notificationCallbacks = [];\n  options = options || {};\n  this._customTimeout = options.timeout;\n  const parsedURL = parseURL(url);\n  const headers = options.headers || {};\n  const protocol = options.protocol || undefined;\n\n  if (parsedURL.username && parsedURL.password) {\n    headers.authorization = 'Basic ' + _btoa(parsedURL.username + ':' + parsedURL.password);\n  }\n\n  const clientConfig = options.clientConfig || undefined;\n\n  if (parsedURL.auth) {\n    headers.authorization = 'Basic ' + _btoa(parsedURL.auth);\n  }\n\n  this.connection = new Ws(url, protocol, undefined, headers, undefined, clientConfig);\n  this.addDefaultEvents();\n\n  this.connection.onmessage = function (e) {\n    const data = typeof e.data === 'string' ? e.data : '';\n\n    _this._parseResponse(data).forEach(function (result) {\n      let id = null;\n\n      if (_.isArray(result)) {\n        result.forEach(function (load) {\n          if (_this.responseCallbacks[load.id]) id = load.id;\n        });\n      } else {\n        id = result.id;\n      }\n\n      if (!id && result && result.method && result.method.indexOf('_subscription') !== -1) {\n        _this.notificationCallbacks.forEach(function (callback) {\n          if (_.isFunction(callback)) callback(result);\n        });\n      } else if (_this.responseCallbacks[id]) {\n        if (!result.error) {\n          _this.responseCallbacks[id](null, result);\n        } else {\n          if (result.error.message === 'subscription not found' && options.subscriptionNotFoundNoThrow) {\n            // eslint-disable-next-line\n            console.warn('subscription not found');\n\n            if (!result.result) {\n              result.result = 'subscription not found';\n            }\n\n            _this.responseCallbacks[id](null, result);\n          } else {\n            _this.responseCallbacks[id](result);\n          }\n        }\n\n        delete _this.responseCallbacks[id];\n      }\n    });\n  };\n\n  Object.defineProperty(this, 'connected', {\n    get: function () {\n      return this.connection && this.connection.readyState === this.connection.OPEN;\n    },\n    enumerable: true\n  });\n};\n\nWebsocketProvider.prototype.addDefaultEvents = function () {\n  const _this = this;\n\n  this.connection.onerror = function () {\n    _this._timeout();\n  };\n\n  this.connection.onclose = function () {\n    _this._timeout();\n\n    _this.reset();\n  };\n};\n\nWebsocketProvider.prototype._parseResponse = function (data) {\n  const _this = this,\n        returnValues = [];\n\n  const dechunkedData = data.replace(/\\}[\\n\\r]?\\{/g, '}|--|{') // }{\n  .replace(/\\}\\][\\n\\r]?\\[\\{/g, '}]|--|[{') // }][{\n  .replace(/\\}[\\n\\r]?\\[\\{/g, '}|--|[{') // }[{\n  .replace(/\\}\\][\\n\\r]?\\{/g, '}]|--|{') // }]{\n  .split('|--|');\n  dechunkedData.forEach(function (data) {\n    if (_this.lastChunk) data = _this.lastChunk + data;\n    let result = null;\n\n    try {\n      result = JSON.parse(data);\n    } catch (e) {\n      _this.lastChunk = data;\n      clearTimeout(_this.lastChunkTimeout);\n      _this.lastChunkTimeout = setTimeout(function () {\n        _this._timeout();\n\n        throw errors.InvalidResponse(data);\n      }, 1000 * 15);\n      return;\n    }\n\n    clearTimeout(_this.lastChunkTimeout);\n    _this.lastChunk = null;\n    if (result) returnValues.push(result);\n  });\n  return returnValues;\n};\n\nWebsocketProvider.prototype._addResponseCallback = function (payload, callback) {\n  const id = payload.id || payload[0].id;\n  const method = payload.method || payload[0].method;\n  this.responseCallbacks[id] = callback;\n  this.responseCallbacks[id].method = method;\n\n  const _this = this;\n\n  if (this._customTimeout) {\n    setTimeout(function () {\n      if (_this.responseCallbacks[id]) {\n        _this.responseCallbacks[id](errors.ConnectionTimeout(_this._customTimeout));\n\n        delete _this.responseCallbacks[id];\n      }\n    }, this._customTimeout);\n  }\n};\n\nWebsocketProvider.prototype._timeout = function () {\n  for (const key in this.responseCallbacks) {\n    // eslint-disable-next-line\n    if (this.responseCallbacks.hasOwnProperty(key)) {\n      this.responseCallbacks[key](errors.InvalidConnection('on WS'));\n      delete this.responseCallbacks[key];\n    }\n  }\n};\n\nWebsocketProvider.prototype.send = function (payload, callback) {\n  const _this = this;\n\n  if (this.connection.readyState === this.connection.CONNECTING) {\n    setTimeout(function () {\n      _this.send(payload, callback);\n    }, 10);\n    return;\n  }\n\n  if (this.connection.readyState !== this.connection.OPEN) {\n    if (typeof this.connection.onerror === 'function') {\n      this.connection.onerror(new Error('connection not open'));\n    }\n\n    callback(new Error('connection not open'));\n    return;\n  }\n\n  this.connection.send(JSON.stringify(payload));\n\n  this._addResponseCallback(payload, callback);\n};\n\nWebsocketProvider.prototype.on = function (type, callback) {\n  if (typeof callback !== 'function') throw new Error('The second parameter callback must be a function.');\n\n  switch (type) {\n    case 'data':\n      this.notificationCallbacks.push(callback);\n      break;\n\n    case 'connect':\n      this.connection.onopen = callback;\n      break;\n\n    case 'end':\n      this.connection.onclose = callback;\n      break;\n\n    case 'error':\n      this.connection.onerror = callback;\n      break;\n\n    case 'accountsChanged':\n      this.accountsChanged = callback;\n      break;\n\n    case 'disconnected':\n      this.disconnected = callback;\n      break;\n  }\n};\n\nWebsocketProvider.prototype.removeListener = function (type, callback) {\n  const _this = this;\n\n  switch (type) {\n    case 'data':\n      this.notificationCallbacks.forEach(function (cb, index) {\n        if (cb === callback) _this.notificationCallbacks.splice(index, 1);\n      });\n      break;\n  }\n};\n\nWebsocketProvider.prototype.removeAllListeners = function (type) {\n  switch (type) {\n    case 'data':\n      this.notificationCallbacks = [];\n      break;\n\n    case 'connect':\n      this.connection.onopen = null;\n      break;\n\n    case 'end':\n      this.connection.onclose = null;\n      break;\n\n    case 'error':\n      this.connection.onerror = null;\n      break;\n\n    default:\n      break;\n  }\n};\n\nWebsocketProvider.prototype.reset = function () {\n  this._timeout();\n\n  this.notificationCallbacks = [];\n  this.addDefaultEvents();\n};\n\nWebsocketProvider.prototype.disconnect = function () {\n  if (this.connection) {\n    this.connection.close();\n  }\n};\n\nexport default WebsocketProvider;","map":{"version":3,"sources":["/home/ryan/dev/defi/shadowtoken/node_modules/@myetherwallet/mewconnect-web-client/src/connectProvider/web3Provider/web3-provider/providers/ws-web3-provider.js"],"names":["_","require","errors","Ws","_btoa","parseURL","url","protocols","window","WebSocket","btoa","URL","WebsocketProvider","options","_this","responseCallbacks","notificationCallbacks","_customTimeout","timeout","parsedURL","headers","protocol","undefined","username","password","authorization","clientConfig","auth","connection","addDefaultEvents","onmessage","e","data","_parseResponse","forEach","result","id","isArray","load","method","indexOf","callback","isFunction","error","message","subscriptionNotFoundNoThrow","console","warn","Object","defineProperty","get","readyState","OPEN","enumerable","prototype","onerror","_timeout","onclose","reset","returnValues","dechunkedData","replace","split","lastChunk","JSON","parse","clearTimeout","lastChunkTimeout","setTimeout","InvalidResponse","push","_addResponseCallback","payload","ConnectionTimeout","key","hasOwnProperty","InvalidConnection","send","CONNECTING","Error","stringify","on","type","onopen","accountsChanged","disconnected","removeListener","cb","index","splice","removeAllListeners","disconnect","close"],"mappings":"AAAA;AACA;;AAEA,MAAMA,CAAC,GAAGC,OAAO,CAAC,YAAD,CAAjB;;AACA,MAAMC,MAAM,GAAGD,OAAO,CAAC,mBAAD,CAAP,CAA6BC,MAA5C;;AAEA,IAAIC,EAAE,GAAG,IAAT;AACA,IAAIC,KAAK,GAAG,IAAZ;AACA,IAAIC,QAAQ,GAAG,IAAf;;AACAF,EAAE,GAAG,UAASG,GAAT,EAAcC,SAAd,EAAyB;AAC5B,MAAIA,SAAJ,EAAe,OAAO,IAAIC,MAAM,CAACC,SAAX,CAAqBH,GAArB,EAA0BC,SAA1B,CAAP;AACf,SAAO,IAAIC,MAAM,CAACC,SAAX,CAAqBH,GAArB,CAAP;AACD,CAHD;;AAIAF,KAAK,GAAGM,IAAR;;AACAL,QAAQ,GAAG,UAASC,GAAT,EAAc;AACvB,SAAO,IAAIK,GAAJ,CAAQL,GAAR,CAAP;AACD,CAFD;;AAGA,MAAMM,iBAAiB,GAAG,SAASA,iBAAT,CAA2BN,GAA3B,EAAgCO,OAAhC,EAAyC;AACjE,QAAMC,KAAK,GAAG,IAAd;;AACA,OAAKC,iBAAL,GAAyB,EAAzB;AACA,OAAKC,qBAAL,GAA6B,EAA7B;AAEAH,EAAAA,OAAO,GAAGA,OAAO,IAAI,EAArB;AACA,OAAKI,cAAL,GAAsBJ,OAAO,CAACK,OAA9B;AACA,QAAMC,SAAS,GAAGd,QAAQ,CAACC,GAAD,CAA1B;AACA,QAAMc,OAAO,GAAGP,OAAO,CAACO,OAAR,IAAmB,EAAnC;AACA,QAAMC,QAAQ,GAAGR,OAAO,CAACQ,QAAR,IAAoBC,SAArC;;AACA,MAAIH,SAAS,CAACI,QAAV,IAAsBJ,SAAS,CAACK,QAApC,EAA8C;AAC5CJ,IAAAA,OAAO,CAACK,aAAR,GACE,WAAWrB,KAAK,CAACe,SAAS,CAACI,QAAV,GAAqB,GAArB,GAA2BJ,SAAS,CAACK,QAAtC,CADlB;AAED;;AACD,QAAME,YAAY,GAAGb,OAAO,CAACa,YAAR,IAAwBJ,SAA7C;;AACA,MAAIH,SAAS,CAACQ,IAAd,EAAoB;AAClBP,IAAAA,OAAO,CAACK,aAAR,GAAwB,WAAWrB,KAAK,CAACe,SAAS,CAACQ,IAAX,CAAxC;AACD;;AACD,OAAKC,UAAL,GAAkB,IAAIzB,EAAJ,CAChBG,GADgB,EAEhBe,QAFgB,EAGhBC,SAHgB,EAIhBF,OAJgB,EAKhBE,SALgB,EAMhBI,YANgB,CAAlB;AASA,OAAKG,gBAAL;;AACA,OAAKD,UAAL,CAAgBE,SAAhB,GAA4B,UAASC,CAAT,EAAY;AACtC,UAAMC,IAAI,GAAG,OAAOD,CAAC,CAACC,IAAT,KAAkB,QAAlB,GAA6BD,CAAC,CAACC,IAA/B,GAAsC,EAAnD;;AACAlB,IAAAA,KAAK,CAACmB,cAAN,CAAqBD,IAArB,EAA2BE,OAA3B,CAAmC,UAASC,MAAT,EAAiB;AAClD,UAAIC,EAAE,GAAG,IAAT;;AACA,UAAIpC,CAAC,CAACqC,OAAF,CAAUF,MAAV,CAAJ,EAAuB;AACrBA,QAAAA,MAAM,CAACD,OAAP,CAAe,UAASI,IAAT,EAAe;AAC5B,cAAIxB,KAAK,CAACC,iBAAN,CAAwBuB,IAAI,CAACF,EAA7B,CAAJ,EAAsCA,EAAE,GAAGE,IAAI,CAACF,EAAV;AACvC,SAFD;AAGD,OAJD,MAIO;AACLA,QAAAA,EAAE,GAAGD,MAAM,CAACC,EAAZ;AACD;;AACD,UACE,CAACA,EAAD,IACAD,MADA,IAEAA,MAAM,CAACI,MAFP,IAGAJ,MAAM,CAACI,MAAP,CAAcC,OAAd,CAAsB,eAAtB,MAA2C,CAAC,CAJ9C,EAKE;AACA1B,QAAAA,KAAK,CAACE,qBAAN,CAA4BkB,OAA5B,CAAoC,UAASO,QAAT,EAAmB;AACrD,cAAIzC,CAAC,CAAC0C,UAAF,CAAaD,QAAb,CAAJ,EAA4BA,QAAQ,CAACN,MAAD,CAAR;AAC7B,SAFD;AAGD,OATD,MASO,IAAIrB,KAAK,CAACC,iBAAN,CAAwBqB,EAAxB,CAAJ,EAAiC;AACtC,YAAG,CAACD,MAAM,CAACQ,KAAX,EAAiB;AACf7B,UAAAA,KAAK,CAACC,iBAAN,CAAwBqB,EAAxB,EAA4B,IAA5B,EAAkCD,MAAlC;AACD,SAFD,MAEO;AACH,cAAIA,MAAM,CAACQ,KAAP,CAAaC,OAAb,KAAyB,wBAAzB,IAAqD/B,OAAO,CAACgC,2BAAjE,EAA8F;AAC5F;AACAC,YAAAA,OAAO,CAACC,IAAR,CAAa,wBAAb;;AACA,gBAAI,CAACZ,MAAM,CAACA,MAAZ,EAAoB;AAClBA,cAAAA,MAAM,CAACA,MAAP,GAAgB,wBAAhB;AACD;;AACDrB,YAAAA,KAAK,CAACC,iBAAN,CAAwBqB,EAAxB,EAA4B,IAA5B,EAAkCD,MAAlC;AACD,WAPD,MAOO;AACLrB,YAAAA,KAAK,CAACC,iBAAN,CAAwBqB,EAAxB,EAA4BD,MAA5B;AACD;AACJ;;AACD,eAAOrB,KAAK,CAACC,iBAAN,CAAwBqB,EAAxB,CAAP;AACD;AACF,KAnCD;AAoCD,GAtCD;;AAuCAY,EAAAA,MAAM,CAACC,cAAP,CAAsB,IAAtB,EAA4B,WAA5B,EAAyC;AACvCC,IAAAA,GAAG,EAAE,YAAW;AACd,aACE,KAAKtB,UAAL,IAAmB,KAAKA,UAAL,CAAgBuB,UAAhB,KAA+B,KAAKvB,UAAL,CAAgBwB,IADpE;AAGD,KALsC;AAMvCC,IAAAA,UAAU,EAAE;AAN2B,GAAzC;AAQD,CA3ED;;AA4EAzC,iBAAiB,CAAC0C,SAAlB,CAA4BzB,gBAA5B,GAA+C,YAAW;AACxD,QAAMf,KAAK,GAAG,IAAd;;AAEA,OAAKc,UAAL,CAAgB2B,OAAhB,GAA0B,YAAW;AACnCzC,IAAAA,KAAK,CAAC0C,QAAN;AACD,GAFD;;AAIA,OAAK5B,UAAL,CAAgB6B,OAAhB,GAA0B,YAAW;AACnC3C,IAAAA,KAAK,CAAC0C,QAAN;;AACA1C,IAAAA,KAAK,CAAC4C,KAAN;AACD,GAHD;AAID,CAXD;;AAYA9C,iBAAiB,CAAC0C,SAAlB,CAA4BrB,cAA5B,GAA6C,UAASD,IAAT,EAAe;AAC1D,QAAMlB,KAAK,GAAG,IAAd;AAAA,QACE6C,YAAY,GAAG,EADjB;;AAEA,QAAMC,aAAa,GAAG5B,IAAI,CACvB6B,OADmB,CACX,cADW,EACK,QADL,EACe;AADf,GAEnBA,OAFmB,CAEX,kBAFW,EAES,UAFT,EAEqB;AAFrB,GAGnBA,OAHmB,CAGX,gBAHW,EAGO,SAHP,EAGkB;AAHlB,GAInBA,OAJmB,CAIX,gBAJW,EAIO,SAJP,EAIkB;AAJlB,GAKnBC,KALmB,CAKb,MALa,CAAtB;AAOAF,EAAAA,aAAa,CAAC1B,OAAd,CAAsB,UAASF,IAAT,EAAe;AACnC,QAAIlB,KAAK,CAACiD,SAAV,EAAqB/B,IAAI,GAAGlB,KAAK,CAACiD,SAAN,GAAkB/B,IAAzB;AACrB,QAAIG,MAAM,GAAG,IAAb;;AACA,QAAI;AACFA,MAAAA,MAAM,GAAG6B,IAAI,CAACC,KAAL,CAAWjC,IAAX,CAAT;AACD,KAFD,CAEE,OAAOD,CAAP,EAAU;AACVjB,MAAAA,KAAK,CAACiD,SAAN,GAAkB/B,IAAlB;AACAkC,MAAAA,YAAY,CAACpD,KAAK,CAACqD,gBAAP,CAAZ;AACArD,MAAAA,KAAK,CAACqD,gBAAN,GAAyBC,UAAU,CAAC,YAAW;AAC7CtD,QAAAA,KAAK,CAAC0C,QAAN;;AACA,cAAMtD,MAAM,CAACmE,eAAP,CAAuBrC,IAAvB,CAAN;AACD,OAHkC,EAGhC,OAAO,EAHyB,CAAnC;AAKA;AACD;;AACDkC,IAAAA,YAAY,CAACpD,KAAK,CAACqD,gBAAP,CAAZ;AACArD,IAAAA,KAAK,CAACiD,SAAN,GAAkB,IAAlB;AAEA,QAAI5B,MAAJ,EAAYwB,YAAY,CAACW,IAAb,CAAkBnC,MAAlB;AACb,GAnBD;AAqBA,SAAOwB,YAAP;AACD,CAhCD;;AAkCA/C,iBAAiB,CAAC0C,SAAlB,CAA4BiB,oBAA5B,GAAmD,UAASC,OAAT,EAAkB/B,QAAlB,EAA4B;AAC7E,QAAML,EAAE,GAAGoC,OAAO,CAACpC,EAAR,IAAcoC,OAAO,CAAC,CAAD,CAAP,CAAWpC,EAApC;AACA,QAAMG,MAAM,GAAGiC,OAAO,CAACjC,MAAR,IAAkBiC,OAAO,CAAC,CAAD,CAAP,CAAWjC,MAA5C;AAEA,OAAKxB,iBAAL,CAAuBqB,EAAvB,IAA6BK,QAA7B;AACA,OAAK1B,iBAAL,CAAuBqB,EAAvB,EAA2BG,MAA3B,GAAoCA,MAApC;;AAEA,QAAMzB,KAAK,GAAG,IAAd;;AACA,MAAI,KAAKG,cAAT,EAAyB;AACvBmD,IAAAA,UAAU,CAAC,YAAW;AACpB,UAAItD,KAAK,CAACC,iBAAN,CAAwBqB,EAAxB,CAAJ,EAAiC;AAC/BtB,QAAAA,KAAK,CAACC,iBAAN,CAAwBqB,EAAxB,EACElC,MAAM,CAACuE,iBAAP,CAAyB3D,KAAK,CAACG,cAA/B,CADF;;AAGA,eAAOH,KAAK,CAACC,iBAAN,CAAwBqB,EAAxB,CAAP;AACD;AACF,KAPS,EAOP,KAAKnB,cAPE,CAAV;AAQD;AACF,CAlBD;;AAmBAL,iBAAiB,CAAC0C,SAAlB,CAA4BE,QAA5B,GAAuC,YAAW;AAChD,OAAK,MAAMkB,GAAX,IAAkB,KAAK3D,iBAAvB,EAA0C;AACxC;AACA,QAAI,KAAKA,iBAAL,CAAuB4D,cAAvB,CAAsCD,GAAtC,CAAJ,EAAgD;AAC9C,WAAK3D,iBAAL,CAAuB2D,GAAvB,EAA4BxE,MAAM,CAAC0E,iBAAP,CAAyB,OAAzB,CAA5B;AACA,aAAO,KAAK7D,iBAAL,CAAuB2D,GAAvB,CAAP;AACD;AACF;AACF,CARD;;AASA9D,iBAAiB,CAAC0C,SAAlB,CAA4BuB,IAA5B,GAAmC,UAASL,OAAT,EAAkB/B,QAAlB,EAA4B;AAC7D,QAAM3B,KAAK,GAAG,IAAd;;AACA,MAAI,KAAKc,UAAL,CAAgBuB,UAAhB,KAA+B,KAAKvB,UAAL,CAAgBkD,UAAnD,EAA+D;AAC7DV,IAAAA,UAAU,CAAC,YAAW;AACpBtD,MAAAA,KAAK,CAAC+D,IAAN,CAAWL,OAAX,EAAoB/B,QAApB;AACD,KAFS,EAEP,EAFO,CAAV;AAGA;AACD;;AACD,MAAI,KAAKb,UAAL,CAAgBuB,UAAhB,KAA+B,KAAKvB,UAAL,CAAgBwB,IAAnD,EAAyD;AACvD,QAAI,OAAO,KAAKxB,UAAL,CAAgB2B,OAAvB,KAAmC,UAAvC,EAAmD;AACjD,WAAK3B,UAAL,CAAgB2B,OAAhB,CAAwB,IAAIwB,KAAJ,CAAU,qBAAV,CAAxB;AACD;;AACDtC,IAAAA,QAAQ,CAAC,IAAIsC,KAAJ,CAAU,qBAAV,CAAD,CAAR;AACA;AACD;;AAED,OAAKnD,UAAL,CAAgBiD,IAAhB,CAAqBb,IAAI,CAACgB,SAAL,CAAeR,OAAf,CAArB;;AACA,OAAKD,oBAAL,CAA0BC,OAA1B,EAAmC/B,QAAnC;AACD,CAlBD;;AAoBA7B,iBAAiB,CAAC0C,SAAlB,CAA4B2B,EAA5B,GAAiC,UAASC,IAAT,EAAezC,QAAf,EAAyB;AACxD,MAAI,OAAOA,QAAP,KAAoB,UAAxB,EACE,MAAM,IAAIsC,KAAJ,CAAU,mDAAV,CAAN;;AAEF,UAAQG,IAAR;AACE,SAAK,MAAL;AACE,WAAKlE,qBAAL,CAA2BsD,IAA3B,CAAgC7B,QAAhC;AACA;;AAEF,SAAK,SAAL;AACE,WAAKb,UAAL,CAAgBuD,MAAhB,GAAyB1C,QAAzB;AACA;;AAEF,SAAK,KAAL;AACE,WAAKb,UAAL,CAAgB6B,OAAhB,GAA0BhB,QAA1B;AACA;;AAEF,SAAK,OAAL;AACE,WAAKb,UAAL,CAAgB2B,OAAhB,GAA0Bd,QAA1B;AACA;;AAEF,SAAK,iBAAL;AACE,WAAK2C,eAAL,GAAuB3C,QAAvB;AACA;;AACF,SAAK,cAAL;AACE,WAAK4C,YAAL,GAAoB5C,QAApB;AACA;AAtBJ;AAwBD,CA5BD;;AA8BA7B,iBAAiB,CAAC0C,SAAlB,CAA4BgC,cAA5B,GAA6C,UAASJ,IAAT,EAAezC,QAAf,EAAyB;AACpE,QAAM3B,KAAK,GAAG,IAAd;;AAEA,UAAQoE,IAAR;AACE,SAAK,MAAL;AACE,WAAKlE,qBAAL,CAA2BkB,OAA3B,CAAmC,UAASqD,EAAT,EAAaC,KAAb,EAAoB;AACrD,YAAID,EAAE,KAAK9C,QAAX,EAAqB3B,KAAK,CAACE,qBAAN,CAA4ByE,MAA5B,CAAmCD,KAAnC,EAA0C,CAA1C;AACtB,OAFD;AAGA;AALJ;AAOD,CAVD;;AAWA5E,iBAAiB,CAAC0C,SAAlB,CAA4BoC,kBAA5B,GAAiD,UAASR,IAAT,EAAe;AAC9D,UAAQA,IAAR;AACE,SAAK,MAAL;AACE,WAAKlE,qBAAL,GAA6B,EAA7B;AACA;;AACF,SAAK,SAAL;AACE,WAAKY,UAAL,CAAgBuD,MAAhB,GAAyB,IAAzB;AACA;;AAEF,SAAK,KAAL;AACE,WAAKvD,UAAL,CAAgB6B,OAAhB,GAA0B,IAA1B;AACA;;AAEF,SAAK,OAAL;AACE,WAAK7B,UAAL,CAAgB2B,OAAhB,GAA0B,IAA1B;AACA;;AAEF;AACE;AAjBJ;AAmBD,CApBD;;AAsBA3C,iBAAiB,CAAC0C,SAAlB,CAA4BI,KAA5B,GAAoC,YAAW;AAC7C,OAAKF,QAAL;;AACA,OAAKxC,qBAAL,GAA6B,EAA7B;AACA,OAAKa,gBAAL;AACD,CAJD;;AAMAjB,iBAAiB,CAAC0C,SAAlB,CAA4BqC,UAA5B,GAAyC,YAAW;AAClD,MAAI,KAAK/D,UAAT,EAAqB;AACnB,SAAKA,UAAL,CAAgBgE,KAAhB;AACD;AACF,CAJD;;AAMA,eAAehF,iBAAf","sourcesContent":["/* eslint-disable */\n'use strict';\n\nconst _ = require('underscore');\nconst errors = require('web3-core-helpers').errors;\n\nlet Ws = null;\nlet _btoa = null;\nlet parseURL = null;\nWs = function(url, protocols) {\n  if (protocols) return new window.WebSocket(url, protocols);\n  return new window.WebSocket(url);\n};\n_btoa = btoa;\nparseURL = function(url) {\n  return new URL(url);\n};\nconst WebsocketProvider = function WebsocketProvider(url, options) {\n  const _this = this;\n  this.responseCallbacks = {};\n  this.notificationCallbacks = [];\n\n  options = options || {};\n  this._customTimeout = options.timeout;\n  const parsedURL = parseURL(url);\n  const headers = options.headers || {};\n  const protocol = options.protocol || undefined;\n  if (parsedURL.username && parsedURL.password) {\n    headers.authorization =\n      'Basic ' + _btoa(parsedURL.username + ':' + parsedURL.password);\n  }\n  const clientConfig = options.clientConfig || undefined;\n  if (parsedURL.auth) {\n    headers.authorization = 'Basic ' + _btoa(parsedURL.auth);\n  }\n  this.connection = new Ws(\n    url,\n    protocol,\n    undefined,\n    headers,\n    undefined,\n    clientConfig\n  );\n\n  this.addDefaultEvents();\n  this.connection.onmessage = function(e) {\n    const data = typeof e.data === 'string' ? e.data : '';\n    _this._parseResponse(data).forEach(function(result) {\n      let id = null;\n      if (_.isArray(result)) {\n        result.forEach(function(load) {\n          if (_this.responseCallbacks[load.id]) id = load.id;\n        });\n      } else {\n        id = result.id;\n      }\n      if (\n        !id &&\n        result &&\n        result.method &&\n        result.method.indexOf('_subscription') !== -1\n      ) {\n        _this.notificationCallbacks.forEach(function(callback) {\n          if (_.isFunction(callback)) callback(result);\n        });\n      } else if (_this.responseCallbacks[id]) {\n        if(!result.error){\n          _this.responseCallbacks[id](null, result);\n        } else {\n            if (result.error.message === 'subscription not found' && options.subscriptionNotFoundNoThrow) {\n              // eslint-disable-next-line\n              console.warn('subscription not found');\n              if (!result.result) {\n                result.result = 'subscription not found';\n              }\n              _this.responseCallbacks[id](null, result);\n            } else {\n              _this.responseCallbacks[id](result);\n            }\n        }\n        delete _this.responseCallbacks[id];\n      }\n    });\n  };\n  Object.defineProperty(this, 'connected', {\n    get: function() {\n      return (\n        this.connection && this.connection.readyState === this.connection.OPEN\n      );\n    },\n    enumerable: true\n  });\n};\nWebsocketProvider.prototype.addDefaultEvents = function() {\n  const _this = this;\n\n  this.connection.onerror = function() {\n    _this._timeout();\n  };\n\n  this.connection.onclose = function() {\n    _this._timeout();\n    _this.reset();\n  };\n};\nWebsocketProvider.prototype._parseResponse = function(data) {\n  const _this = this,\n    returnValues = [];\n  const dechunkedData = data\n    .replace(/\\}[\\n\\r]?\\{/g, '}|--|{') // }{\n    .replace(/\\}\\][\\n\\r]?\\[\\{/g, '}]|--|[{') // }][{\n    .replace(/\\}[\\n\\r]?\\[\\{/g, '}|--|[{') // }[{\n    .replace(/\\}\\][\\n\\r]?\\{/g, '}]|--|{') // }]{\n    .split('|--|');\n\n  dechunkedData.forEach(function(data) {\n    if (_this.lastChunk) data = _this.lastChunk + data;\n    let result = null;\n    try {\n      result = JSON.parse(data);\n    } catch (e) {\n      _this.lastChunk = data;\n      clearTimeout(_this.lastChunkTimeout);\n      _this.lastChunkTimeout = setTimeout(function() {\n        _this._timeout();\n        throw errors.InvalidResponse(data);\n      }, 1000 * 15);\n\n      return;\n    }\n    clearTimeout(_this.lastChunkTimeout);\n    _this.lastChunk = null;\n\n    if (result) returnValues.push(result);\n  });\n\n  return returnValues;\n};\n\nWebsocketProvider.prototype._addResponseCallback = function(payload, callback) {\n  const id = payload.id || payload[0].id;\n  const method = payload.method || payload[0].method;\n\n  this.responseCallbacks[id] = callback;\n  this.responseCallbacks[id].method = method;\n\n  const _this = this;\n  if (this._customTimeout) {\n    setTimeout(function() {\n      if (_this.responseCallbacks[id]) {\n        _this.responseCallbacks[id](\n          errors.ConnectionTimeout(_this._customTimeout)\n        );\n        delete _this.responseCallbacks[id];\n      }\n    }, this._customTimeout);\n  }\n};\nWebsocketProvider.prototype._timeout = function() {\n  for (const key in this.responseCallbacks) {\n    // eslint-disable-next-line\n    if (this.responseCallbacks.hasOwnProperty(key)) {\n      this.responseCallbacks[key](errors.InvalidConnection('on WS'));\n      delete this.responseCallbacks[key];\n    }\n  }\n};\nWebsocketProvider.prototype.send = function(payload, callback) {\n  const _this = this;\n  if (this.connection.readyState === this.connection.CONNECTING) {\n    setTimeout(function() {\n      _this.send(payload, callback);\n    }, 10);\n    return;\n  }\n  if (this.connection.readyState !== this.connection.OPEN) {\n    if (typeof this.connection.onerror === 'function') {\n      this.connection.onerror(new Error('connection not open'));\n    }\n    callback(new Error('connection not open'));\n    return;\n  }\n\n  this.connection.send(JSON.stringify(payload));\n  this._addResponseCallback(payload, callback);\n};\n\nWebsocketProvider.prototype.on = function(type, callback) {\n  if (typeof callback !== 'function')\n    throw new Error('The second parameter callback must be a function.');\n\n  switch (type) {\n    case 'data':\n      this.notificationCallbacks.push(callback);\n      break;\n\n    case 'connect':\n      this.connection.onopen = callback;\n      break;\n\n    case 'end':\n      this.connection.onclose = callback;\n      break;\n\n    case 'error':\n      this.connection.onerror = callback;\n      break;\n\n    case 'accountsChanged':\n      this.accountsChanged = callback;\n      break;\n    case 'disconnected':\n      this.disconnected = callback;\n      break;\n  }\n};\n\nWebsocketProvider.prototype.removeListener = function(type, callback) {\n  const _this = this;\n\n  switch (type) {\n    case 'data':\n      this.notificationCallbacks.forEach(function(cb, index) {\n        if (cb === callback) _this.notificationCallbacks.splice(index, 1);\n      });\n      break;\n  }\n};\nWebsocketProvider.prototype.removeAllListeners = function(type) {\n  switch (type) {\n    case 'data':\n      this.notificationCallbacks = [];\n      break;\n    case 'connect':\n      this.connection.onopen = null;\n      break;\n\n    case 'end':\n      this.connection.onclose = null;\n      break;\n\n    case 'error':\n      this.connection.onerror = null;\n      break;\n\n    default:\n      break;\n  }\n};\n\nWebsocketProvider.prototype.reset = function() {\n  this._timeout();\n  this.notificationCallbacks = [];\n  this.addDefaultEvents();\n};\n\nWebsocketProvider.prototype.disconnect = function() {\n  if (this.connection) {\n    this.connection.close();\n  }\n};\n\nexport default WebsocketProvider;\n"]},"metadata":{},"sourceType":"module"}